<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ooi Wen Xian">
<meta name="dcterms.date" content="2024-09-25">

<title>IS415-GAA - Take Home Exercise 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-On Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex02/In-Class_Ex02.html">
 <span class="dropdown-text">In-Class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex03/In-Class_Ex03.html">
 <span class="dropdown-text">In-Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex04/In-Class_Ex04.html">
 <span class="dropdown-text">In-Class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex05/In-Class_Ex05.html">
 <span class="dropdown-text">In-Class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex06/In-Class_Ex06.html">
 <span class="dropdown-text">In-Class Exercise 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex01/Take-Home_Ex01.html">
 <span class="dropdown-text">Take-Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex02/Take--Home_Ex02.html">
 <span class="dropdown-text">Take-Home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1.0 Overview</a>
  <ul class="collapse">
  <li><a href="#study-objectives" id="toc-study-objectives" class="nav-link" data-scroll-target="#study-objectives">1.1 Study Objectives</a></li>
  </ul></li>
  <li><a href="#importing-packages" id="toc-importing-packages" class="nav-link" data-scroll-target="#importing-packages">2.0 Importing Packages</a></li>
  <li><a href="#importing-data" id="toc-importing-data" class="nav-link" data-scroll-target="#importing-data">3.0 Importing Data</a>
  <ul class="collapse">
  <li><a href="#importing-geospatial-data" id="toc-importing-geospatial-data" class="nav-link" data-scroll-target="#importing-geospatial-data">3.1 Importing Geospatial Data</a></li>
  <li><a href="#importing-aspatial-data" id="toc-importing-aspatial-data" class="nav-link" data-scroll-target="#importing-aspatial-data">3.2 Importing Aspatial Data</a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">4.0 Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#correcting-province-name-mismatch" id="toc-correcting-province-name-mismatch" class="nav-link" data-scroll-target="#correcting-province-name-mismatch">4.1 Correcting Province Name Mismatch</a></li>
  <li><a href="#drop-redundant-columns" id="toc-drop-redundant-columns" class="nav-link" data-scroll-target="#drop-redundant-columns">4.2 Drop redundant columns</a></li>
  <li><a href="#relational-join" id="toc-relational-join" class="nav-link" data-scroll-target="#relational-join">4.3 Relational Join</a></li>
  <li><a href="#visualising-type-of-drug-offences" id="toc-visualising-type-of-drug-offences" class="nav-link" data-scroll-target="#visualising-type-of-drug-offences">4.4 Visualising Type of Drug offences</a></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation">5.0 Global Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#computing-contiguity-spatial-weights" id="toc-computing-contiguity-spatial-weights" class="nav-link" data-scroll-target="#computing-contiguity-spatial-weights">5.1 Computing Contiguity Spatial Weights</a></li>
  <li><a href="#global-measures-of-spatial-autocorrelation-morans-i" id="toc-global-measures-of-spatial-autocorrelation-morans-i" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation-morans-i">5.2 Global Measures of Spatial Autocorrelation: Moran’s I</a>
  <ul class="collapse">
  <li><a href="#computing-and-visualising-global-morans-i" id="toc-computing-and-visualising-global-morans-i" class="nav-link" data-scroll-target="#computing-and-visualising-global-morans-i">5.2.1 Computing and Visualising Global Moran’s I</a></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation-gearys-c" id="toc-global-measures-of-spatial-autocorrelation-gearys-c" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation-gearys-c">5.3 Global Measures of Spatial Autocorrelation: Geary’s C</a>
  <ul class="collapse">
  <li><a href="#gearys-c-test" id="toc-gearys-c-test" class="nav-link" data-scroll-target="#gearys-c-test">5.3.1 Geary’s C test</a></li>
  <li><a href="#computing-monte-carlo-gearys-c" id="toc-computing-monte-carlo-gearys-c" class="nav-link" data-scroll-target="#computing-monte-carlo-gearys-c">5.3.2 Computing Monte Carlo Geary’s C</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#local-measures-of-spatial-autocorrelation" id="toc-local-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#local-measures-of-spatial-autocorrelation">6.0 Local Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#computing-and-mapping-local-morans-i" id="toc-computing-and-mapping-local-morans-i" class="nav-link" data-scroll-target="#computing-and-mapping-local-morans-i">6.1 Computing and Mapping local Moran’s I</a>
  <ul class="collapse">
  <li><a href="#mapping-the-local-morans-i-p-values" id="toc-mapping-the-local-morans-i-p-values" class="nav-link" data-scroll-target="#mapping-the-local-morans-i-p-values">6.1.1 Mapping the local Moran’s I p-values</a></li>
  </ul></li>
  <li><a href="#creating-a-lisa-cluster-map" id="toc-creating-a-lisa-cluster-map" class="nav-link" data-scroll-target="#creating-a-lisa-cluster-map">6.2 Creating a LISA Cluster Map</a>
  <ul class="collapse">
  <li><a href="#preparing-lisa-map-classes-and-plotting-lisa-map" id="toc-preparing-lisa-map-classes-and-plotting-lisa-map" class="nav-link" data-scroll-target="#preparing-lisa-map-classes-and-plotting-lisa-map">6.2.3 Preparing LISA map classes and Plotting LISA map</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#hot-spot-and-cold-spot-area-analysis" id="toc-hot-spot-and-cold-spot-area-analysis" class="nav-link" data-scroll-target="#hot-spot-and-cold-spot-area-analysis">7.0 Hot Spot and Cold Spot Area Analysis</a>
  <ul class="collapse">
  <li><a href="#getis-and-ords-g-statistics" id="toc-getis-and-ords-g-statistics" class="nav-link" data-scroll-target="#getis-and-ords-g-statistics">7.1 Getis and Ord’s G-Statistics</a></li>
  <li><a href="#cluster-persistance" id="toc-cluster-persistance" class="nav-link" data-scroll-target="#cluster-persistance">7.2 Cluster Persistance</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take Home Exercise 2</h1>
<p class="subtitle lead">Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ooi Wen Xian </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 25, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 13, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>1.0 Overview</h1>
<p>Drug abuse is associated with significant negative health, financial and social consequences. Yet, illicit drug consumption remains highly prevalent and continues to be a growing problem worldwide. In 2021, 1 in 17 people aged 15–64 in the world had used a drug in the past 12 months. Notwithstanding population growth, the estimated number of drug users grew from 240 million in 2011 to 296 million in 2021.</p>
<p>The geopolitics of Thailand which is near the <a href="https://en.wikipedia.org/wiki/Golden_Triangle_(Southeast_Asia)">Golden Triangle</a> of Indochina, the largest drug production site in Asia, and the constant transportation infrastructure development made Thailand became market and transit routes for drug trafficking to the third countries.</p>
<p>In Thailand, drug abuse is one of the major social issue. There are about 2.7 million youths using drugs in Thailand. Among youths aged between 15 and 19 years, there are about 300,000 who have needs for drug treatment. Most of Thai youths involved with drugs are vocational-school students, which nearly doubles in number compared to secondary-school students.</p>
<section id="study-objectives" class="level2">
<h2 class="anchored" data-anchor-id="study-objectives">1.1 Study Objectives</h2>
<p>We are interested to discover:</p>
<ul>
<li><p>if the key indicators of drug abuse of Thailand are independent from space.</p></li>
<li><p>If the indicators of drug abuse is indeed spatial dependent, if then, detect where are the clusters and outliers, and the hotspots.</p></li>
<li><p>How the observations above evolve over time.</p></li>
</ul>
</section>
</section>
<section id="importing-packages" class="level1">
<h1>2.0 Importing Packages</h1>
<p>We need to import the following packages that are used for this study:</p>
<ul>
<li><p><a href="https://rdrr.io/github/r-spatial/sf/man/sf-package.html"><code>sf</code></a> : to import, manage and process vector-based geospatial data in R.</p></li>
<li><p><a href="https://rdrr.io/cran/sf/man/st.html"><code>st</code></a> : creates simple features from numeric vectors, matrices, or lists, enabling the representation and manipulation of spatial structures in R.</p></li>
<li><p><a href="https://www.tidyverse.org/"><code>tidyverse</code></a> : a collection of R packages designed for data science, includes packages like <code>dplyr</code> for data manipulation, <code>ggplot2</code> for data visualization<a href="https://cran.r-project.org/web/packages/spdep/"><code>sfdep</code></a> : for computing spatial weights, global and local spatial autocorrelation statistics</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/tmap/"><code>tmap</code></a> : for creating static and interactive thematic visualisations and maps.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/spdep/"><code>knitr</code></a> : to allow R code to be embedded in R Markdown documents.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf,st, tidyverse, tmap, knitr, sfdep, arrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-data" class="level1">
<h1>3.0 Importing Data</h1>
<p>For the purpose of this study, two data sets shall be used, they are:</p>
<ul>
<li><p><a href="https://www.kaggle.com/datasets/thaweewatboy/thailand-drug-offenses-2017-2022">Thailand Drug Offenses [2017-2022]</a> at Kaggle.</p></li>
<li><p><a href="https://data.humdata.org/dataset/cod-ab-tha?">Thailand - Subnational Administrative Boundaries</a> at HDX. We would be using the province boundary data set.</p></li>
</ul>
<section id="importing-geospatial-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-geospatial-data">3.1 Importing Geospatial Data</h2>
<p>As provinces are administrative level 1, we would be using the <code>tha_admbnda_adm1_rtsd_20220121</code> shapefile.</p>
<p>In this section,&nbsp;<code>st_read()</code>&nbsp;of&nbsp;<strong>sf</strong>&nbsp;package will be used to import&nbsp;<code>tha_admbnda_adm1_rtsd_20220121</code>&nbsp;dataset into R environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>thai_province <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/tha_adm_rtsd_itos_20210121_shp"</span>, <span class="at">layer =</span> <span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `C:\wamp64\www\crediblues\IS415-GAA\Take-Home_Ex\Take-Home_Ex02\data\tha_adm_rtsd_itos_20210121_shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(thai_province)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
<p>We shall convert to UTM Zone 47N (EPSG: 32647), which is often used for Thailand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>thai_province <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(thai_province, <span class="at">crs =</span> <span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(thai_province)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:32647 
  wkt:
PROJCRS["WGS 84 / UTM zone 47N",
    BASEGEOGCRS["WGS 84",
        ENSEMBLE["World Geodetic System 1984 ensemble",
            MEMBER["World Geodetic System 1984 (Transit)"],
            MEMBER["World Geodetic System 1984 (G730)"],
            MEMBER["World Geodetic System 1984 (G873)"],
            MEMBER["World Geodetic System 1984 (G1150)"],
            MEMBER["World Geodetic System 1984 (G1674)"],
            MEMBER["World Geodetic System 1984 (G1762)"],
            MEMBER["World Geodetic System 1984 (G2139)"],
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]],
            ENSEMBLEACCURACY[2.0]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 47N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",99,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Navigation and medium accuracy spatial referencing."],
        AREA["Between 96°E and 102°E, northern hemisphere between equator and 84°N, onshore and offshore. China. Indonesia. Laos. Malaysia - West Malaysia. Mongolia. Myanmar (Burma). Russian Federation. Thailand."],
        BBOX[0,96,84,102]],
    ID["EPSG",32647]]</code></pre>
</div>
</div>
<p>Let’s take a look at what is in <code>tha_province_admin_boundary</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>thai_province</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
First 10 features:
   Shape_Leng Shape_Area                  ADM1_EN       ADM1_TH ADM1_PCODE
1    2.417227 0.13133873                  Bangkok  กรุงเทพมหานคร       TH10
2    1.695100 0.07926199             Samut Prakan    สมุทรปราการ       TH11
3    1.251111 0.05323766               Nonthaburi         นนทบุรี       TH12
4    1.884945 0.12698345             Pathum Thani        ปทุมธานี       TH13
5    3.041716 0.21393797 Phra Nakhon Si Ayutthaya พระนครศรีอยุธยา       TH14
6    1.739908 0.07920961                Ang Thong        อ่างทอง       TH15
7    5.693342 0.54578838                 Lop Buri          ลพบุรี       TH16
8    1.778326 0.06872655                Sing Buri         สิงห์บุรี       TH17
9    2.896316 0.20907828                 Chai Nat         ชัยนาท       TH18
10   4.766446 0.29208711                 Saraburi         สระบุรี       TH19
   ADM1_REF ADM1ALT1EN ADM1ALT2EN ADM1ALT1TH ADM1ALT2TH  ADM0_EN   ADM0_TH
1      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
2      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
3      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
4      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
5      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
6      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
7      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
8      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
9      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
10     &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
   ADM0_PCODE       date    validOn    validTo                       geometry
1          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((674339.8 15...
2          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((687139.8 15...
3          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((644817.9 15...
4          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((704086 1575...
5          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((662941.6 16...
6          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((643472.8 16...
7          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((751293.3 17...
8          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((647136.1 16...
9          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((620165.4 17...
10         TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((757935.1 16...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(thai_province)<span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd=</span><span class="fl">0.3</span>, <span class="at">alpha=</span><span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Provinces in Thailand"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="importing-aspatial-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-aspatial-data">3.2 Importing Aspatial Data</h2>
<p>In this section, <code>read_csv()</code> of <strong>sf</strong> package will be used to import the csv file into R environment. The output is R dataframe class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tha_drug_offences <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/thai_drug_offenses_2017_2022.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 7392 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): types_of_drug_offenses, province_th, province_en
dbl (2): fiscal_year, no_cases

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tha_drug_offences</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,392 × 5
   fiscal_year types_of_drug_offenses no_cases province_th   province_en        
         &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;              
 1        2017 drug_use_cases            11871 กรุงเทพมหานคร  Bangkok            
 2        2017 drug_use_cases              200 ชัยนาท         Chai Nat           
 3        2017 drug_use_cases              553 นนทบุรี         Nonthaburi         
 4        2017 drug_use_cases              450 ปทุมธานี        Pathum Thani       
 5        2017 drug_use_cases              378 พระนครศรีอยุธยา Phra Nakhon Si Ayu…
 6        2017 drug_use_cases              727 ลพบุรี          Loburi             
 7        2017 drug_use_cases              820 สมุทรปราการ    Samut Prakan       
 8        2017 drug_use_cases               69 สระบุรี         Saraburi           
 9        2017 drug_use_cases              127 สิงห์บุรี         Sing Buri          
10        2017 drug_use_cases              208 อ่างทอง        Ang Thong          
# ℹ 7,382 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="data-wrangling" class="level1">
<h1>4.0 Data Wrangling</h1>
<section id="correcting-province-name-mismatch" class="level2">
<h2 class="anchored" data-anchor-id="correcting-province-name-mismatch">4.1 Correcting Province Name Mismatch</h2>
<p>Let’s check if the names of the provinces in our geospatial and aspatial data match each other</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tha_drug_offences_provinces <span class="ot">&lt;-</span> <span class="fu">unique</span>(tha_drug_offences<span class="sc">$</span>province_en)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>thai_province_provinces <span class="ot">&lt;-</span> <span class="fu">unique</span>(thai_province<span class="sc">$</span>ADM1_EN)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Find provinces in drug data that don't match the spatial data</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>mismatched_drug_provinces <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(tha_drug_offences_provinces, thai_province_provinces)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find provinces in spatial data that don't match the drug data</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>mismatched_spatial_provinces <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(thai_province_provinces, tha_drug_offences_provinces)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mismatched province names</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Provinces in drug data but not in spatial data:</span><span class="sc">\n</span><span class="st">"</span>, mismatched_drug_provinces, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Provinces in drug data but not in spatial data:
 Loburi buogkan </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Provinces in spatial data but not in drug data:</span><span class="sc">\n</span><span class="st">"</span>, mismatched_spatial_provinces, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Provinces in spatial data but not in drug data:
 Lop Buri Bueng Kan </code></pre>
</div>
</div>
<p>The provinces for Lop Buri and Bueng Kan are misspelled in <code>tha_drug_offences_provinces</code> .</p>
<p>Let’s rename them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tha_drug_offences <span class="ot">&lt;-</span> tha_drug_offences <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">province_en =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    province_en <span class="sc">==</span> <span class="st">"Loburi"</span> <span class="sc">~</span> <span class="st">"Lop Buri"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    province_en <span class="sc">==</span> <span class="st">"buogkan"</span> <span class="sc">~</span> <span class="st">"Bueng Kan"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> province_en  <span class="co"># Keep other names unchanged</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Checking again for mismatch</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tha_drug_offences_provinces <span class="ot">&lt;-</span> <span class="fu">unique</span>(tha_drug_offences<span class="sc">$</span>province_en)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>thai_province_provinces <span class="ot">&lt;-</span> <span class="fu">unique</span>(thai_province<span class="sc">$</span>ADM1_EN)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Find provinces in drug data that don't match the spatial data</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>mismatched_drug_provinces <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(tha_drug_offences_provinces, thai_province_provinces)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find provinces in spatial data that don't match the drug data</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>mismatched_spatial_provinces <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(thai_province_provinces, tha_drug_offences_provinces)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mismatched province names</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Provinces in drug data but not in spatial data:</span><span class="sc">\n</span><span class="st">"</span>, mismatched_drug_provinces, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Provinces in drug data but not in spatial data:
  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Provinces in spatial data but not in drug data:</span><span class="sc">\n</span><span class="st">"</span>, mismatched_spatial_provinces, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Provinces in spatial data but not in drug data:
  </code></pre>
</div>
</div>
</section>
<section id="drop-redundant-columns" class="level2">
<h2 class="anchored" data-anchor-id="drop-redundant-columns">4.2 Drop redundant columns</h2>
<p>To reduce the memory load, we can drop columns which are not relevant for this study and store only relevant columns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tha_drug_offences <span class="ot">&lt;-</span> <span class="fu">subset</span>(tha_drug_offences, <span class="at">select =</span> <span class="fu">c</span>(fiscal_year, province_en, no_cases, types_of_drug_offenses))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>tha_drug_offences</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,392 × 4
   fiscal_year province_en              no_cases types_of_drug_offenses
         &lt;dbl&gt; &lt;chr&gt;                       &lt;dbl&gt; &lt;chr&gt;                 
 1        2017 Bangkok                     11871 drug_use_cases        
 2        2017 Chai Nat                      200 drug_use_cases        
 3        2017 Nonthaburi                    553 drug_use_cases        
 4        2017 Pathum Thani                  450 drug_use_cases        
 5        2017 Phra Nakhon Si Ayutthaya      378 drug_use_cases        
 6        2017 Lop Buri                      727 drug_use_cases        
 7        2017 Samut Prakan                  820 drug_use_cases        
 8        2017 Saraburi                       69 drug_use_cases        
 9        2017 Sing Buri                     127 drug_use_cases        
10        2017 Ang Thong                     208 drug_use_cases        
# ℹ 7,382 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>thai_province <span class="ot">&lt;-</span> <span class="fu">subset</span>(thai_province, <span class="at">select =</span> <span class="fu">c</span>(Shape_Leng, Shape_Area, ADM1_EN, geometry))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>thai_province </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
First 10 features:
   Shape_Leng Shape_Area                  ADM1_EN
1    2.417227 0.13133873                  Bangkok
2    1.695100 0.07926199             Samut Prakan
3    1.251111 0.05323766               Nonthaburi
4    1.884945 0.12698345             Pathum Thani
5    3.041716 0.21393797 Phra Nakhon Si Ayutthaya
6    1.739908 0.07920961                Ang Thong
7    5.693342 0.54578838                 Lop Buri
8    1.778326 0.06872655                Sing Buri
9    2.896316 0.20907828                 Chai Nat
10   4.766446 0.29208711                 Saraburi
                         geometry
1  MULTIPOLYGON (((674339.8 15...
2  MULTIPOLYGON (((687139.8 15...
3  MULTIPOLYGON (((644817.9 15...
4  MULTIPOLYGON (((704086 1575...
5  MULTIPOLYGON (((662941.6 16...
6  MULTIPOLYGON (((643472.8 16...
7  MULTIPOLYGON (((751293.3 17...
8  MULTIPOLYGON (((647136.1 16...
9  MULTIPOLYGON (((620165.4 17...
10 MULTIPOLYGON (((757935.1 16...</code></pre>
</div>
</div>
</section>
<section id="relational-join" class="level2">
<h2 class="anchored" data-anchor-id="relational-join">4.3 Relational Join</h2>
<p>Since <code>tha_drug_offences</code> only contains province names without any geometry, we will need to perform a <strong>spatial join</strong> to associate the drug data with the province boundaries.</p>
<p>The code chunk below will be used to join the attribute tables of <code>thai_province</code>’s SpatialPolygonsDataFrame with the attribute fields of <code>tha_drug_offences</code> dataframe. This is performed by using <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html"><code>left_join()</code></a> of <strong>dplyr</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>thai_province <span class="ot">&lt;-</span> thai_province <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tha_drug_offences , <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>thai_province</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 7392 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
First 10 features:
   Shape_Leng Shape_Area ADM1_EN fiscal_year no_cases
1    2.417227  0.1313387 Bangkok        2017    11871
2    2.417227  0.1313387 Bangkok        2018    16480
3    2.417227  0.1313387 Bangkok        2019    15067
4    2.417227  0.1313387 Bangkok        2020     9724
5    2.417227  0.1313387 Bangkok        2021     9625
6    2.417227  0.1313387 Bangkok        2022     2755
7    2.417227  0.1313387 Bangkok        2017    12371
8    2.417227  0.1313387 Bangkok        2018    17131
9    2.417227  0.1313387 Bangkok        2019    15458
10   2.417227  0.1313387 Bangkok        2020     9754
       types_of_drug_offenses                       geometry
1              drug_use_cases MULTIPOLYGON (((674339.8 15...
2              drug_use_cases MULTIPOLYGON (((674339.8 15...
3              drug_use_cases MULTIPOLYGON (((674339.8 15...
4              drug_use_cases MULTIPOLYGON (((674339.8 15...
5              drug_use_cases MULTIPOLYGON (((674339.8 15...
6              drug_use_cases MULTIPOLYGON (((674339.8 15...
7  suspects_in_drug_use_cases MULTIPOLYGON (((674339.8 15...
8  suspects_in_drug_use_cases MULTIPOLYGON (((674339.8 15...
9  suspects_in_drug_use_cases MULTIPOLYGON (((674339.8 15...
10 suspects_in_drug_use_cases MULTIPOLYGON (((674339.8 15...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>drug_offense_summary <span class="ot">&lt;-</span> thai_province <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ADM1_EN, types_of_drug_offenses) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>drug_offense_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1232 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 1,232 × 4
   ADM1_EN       types_of_drug_offenses    total_cases                  geometry
   &lt;chr&gt;         &lt;chr&gt;                           &lt;dbl&gt;        &lt;MULTIPOLYGON [m]&gt;
 1 Amnat Charoen conspiracy_cases                    5 (((1137720 1809629, 1137…
 2 Amnat Charoen drug_use_cases                  11695 (((1137720 1809629, 1137…
 3 Amnat Charoen export_cases                        0 (((1137720 1809629, 1137…
 4 Amnat Charoen import_cases                        9 (((1137720 1809629, 1137…
 5 Amnat Charoen possession_cases                 2127 (((1137720 1809629, 1137…
 6 Amnat Charoen possession_with_intent_t…        2298 (((1137720 1809629, 1137…
 7 Amnat Charoen production_cases                  280 (((1137720 1809629, 1137…
 8 Amnat Charoen suspects_in_conspiracy_c…          13 (((1137720 1809629, 1137…
 9 Amnat Charoen suspects_in_drug_use_cas…       11829 (((1137720 1809629, 1137…
10 Amnat Charoen suspects_in_export_cases            0 (((1137720 1809629, 1137…
# ℹ 1,222 more rows</code></pre>
</div>
</div>
<p>Since we are concerned about drug use cases, let’s filter our data for specific indicators only. We would be using these 5 indicators for our analysis.</p>
<ul>
<li><p>drug_use_cases</p></li>
<li><p>possession_cases</p></li>
<li><p>possession_with_intent_to_distribute_cases</p></li>
<li><p>production_cases</p></li>
<li><p>trafficking_cases</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>drug_abuse_indicators_summary <span class="ot">&lt;-</span> thai_province <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"drug_use_cases"</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"possession_cases"</span>, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"possession_with_intent_to_distribute_cases"</span>, </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"production_cases"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"trafficking_cases"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ADM1_EN, fiscal_year, types_of_drug_offenses) <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View the drug abuse indicators layer</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>drug_abuse_indicators_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2310 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 2,310 × 5
   ADM1_EN       fiscal_year types_of_drug_offenses                  total_cases
   &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;                                         &lt;dbl&gt;
 1 Amnat Charoen        2017 drug_use_cases                                 1734
 2 Amnat Charoen        2017 possession_cases                                293
 3 Amnat Charoen        2017 possession_with_intent_to_distribute_c…         241
 4 Amnat Charoen        2017 production_cases                                 14
 5 Amnat Charoen        2017 trafficking_cases                               211
 6 Amnat Charoen        2018 drug_use_cases                                 2038
 7 Amnat Charoen        2018 possession_cases                                307
 8 Amnat Charoen        2018 possession_with_intent_to_distribute_c…         269
 9 Amnat Charoen        2018 production_cases                                 11
10 Amnat Charoen        2018 trafficking_cases                               143
# ℹ 2,300 more rows
# ℹ 1 more variable: geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(drug_abuse_indicators_summary<span class="sc">$</span>fiscal_year)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year to create and save individual plots</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> years) {</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  year_data <span class="ot">&lt;-</span> drug_abuse_indicators_summary <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(year_data, <span class="fu">aes</span>(<span class="at">x =</span> ADM1_EN, <span class="at">y =</span> total_cases, <span class="at">fill =</span> types_of_drug_offenses)) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Create bars for total cases</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Distribution of Drug Abuse Indicators in"</span>, year),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Province"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Type of Drug Offense"</span>) <span class="sc">+</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Use a minimal theme</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>),</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set3"</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-17-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-17-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-17-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-17-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualising-type-of-drug-offences" class="level2">
<h2 class="anchored" data-anchor-id="visualising-type-of-drug-offences">4.4 Visualising Type of Drug offences</h2>
<p>Let’s visualise the distribution of total drug cases from our indicators by using qtm() of tmap package, via equal and quantile classification styles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>drug_offense_summary_all_cases <span class="ot">&lt;-</span> thai_province <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ADM1_EN, fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">geometry =</span> <span class="fu">first</span>(geometry), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(drug_offense_summary_all_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 462 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 462 × 4
   ADM1_EN       fiscal_year total_cases                                geometry
   &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;                      &lt;MULTIPOLYGON [m]&gt;
 1 Amnat Charoen        2017        5076 (((1137720 1809629, 1137724 1809622, 1…
 2 Amnat Charoen        2018        5651 (((1137720 1809629, 1137724 1809622, 1…
 3 Amnat Charoen        2019        7339 (((1137720 1809629, 1137724 1809622, 1…
 4 Amnat Charoen        2020        3949 (((1137720 1809629, 1137724 1809622, 1…
 5 Amnat Charoen        2021        8961 (((1137720 1809629, 1137724 1809622, 1…
 6 Amnat Charoen        2022        4459 (((1137720 1809629, 1137724 1809622, 1…
 7 Ang Thong            2017        1614 (((643472.8 1636469, 643496 1636423, 6…
 8 Ang Thong            2018        2717 (((643472.8 1636469, 643496 1636423, 6…
 9 Ang Thong            2019        2781 (((643472.8 1636469, 643496 1636423, 6…
10 Ang Thong            2020        2636 (((643472.8 1636469, 643496 1636423, 6…
# ℹ 452 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(drug_offense_summary_all_cases<span class="sc">$</span>fiscal_year)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> years) {</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  year_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases[drug_offense_summary_all_cases<span class="sc">$</span>fiscal_year <span class="sc">==</span> year, ]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a map with equal interval classification</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(year_data) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_fill</span>(<span class="st">"total_cases"</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="st">"equal"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">"Total Drug Use Cases"</span>) <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"Equal Interval -"</span>, year), <span class="at">title.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a map with quantile classification</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(year_data) <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_fill</span>(<span class="st">"total_cases"</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="st">"quantile"</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">"Total Drug Use Cases"</span>) <span class="sc">+</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"Quantile -"</span>, year), <span class="at">title.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  tmap_arranged <span class="ot">&lt;-</span> <span class="fu">tmap_arrange</span>(equal, quantile, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmap_arranged)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-19-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-19-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-19-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level1">
<h1>5.0 Global Measures of Spatial Autocorrelation</h1>
<p>In this section, we would be computing global spatial autocorrelation statistics and to perform spatial complete randomness test for global spatial autocorrelation.</p>
<section id="computing-contiguity-spatial-weights" class="level2">
<h2 class="anchored" data-anchor-id="computing-contiguity-spatial-weights">5.1 Computing Contiguity Spatial Weights</h2>
<p>Before we can compute the global spatial autocorrelation statistics, we need to construct a spatial weights of the study area. The spatial weights is used to define the neighbourhood relationships between the geographical units (i.e.&nbsp;province) in the study area.</p>
<p>In the code chunk below, st_neighbors() from sfdep package is used to compute contiguity weight matrices for the study area. This function builds a neighbours list based on regions with contiguous boundaries.</p>
<p>The code chunk below is used to compute Queen contiguity weight matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>yearly_nb_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each fiscal year</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">unique</span>(drug_offense_summary_all_cases<span class="sc">$</span>fiscal_year)) {</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  wm_sf <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(yearly_data, <span class="at">queen=</span><span class="cn">TRUE</span>) </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  yearly_nb_data[[<span class="fu">as.character</span>(year)]] <span class="ot">&lt;-</span> wm_sf</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Summary for year"</span>, year))</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(wm_sf))</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary for year 2017"
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.
Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary for year 2018"
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.
Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary for year 2019"
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.
Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary for year 2020"
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.
Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary for year 2021"
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.
Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary for year 2022"
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
</div>
<p>Phuket is the disconnected province, which makes sense geographically, as Phuket is an island province in Thailand, which could lead to its being classified as a separate component in spatial neighbor analysis and it being isolated when using the st_contiguity() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">unique</span>(drug_offense_summary_all_cases<span class="sc">$</span>fiscal_year)) {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  wm_sf <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(yearly_data, <span class="at">queen =</span> <span class="cn">TRUE</span>) </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  yearly_nb_data[[<span class="fu">as.character</span>(year)]] <span class="ot">&lt;-</span> wm_sf</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Summary for year"</span>, year))</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(wm_sf))</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary for year 2017"
Neighbour list object:
Number of regions: 76 
Number of nonzero links: 352 
Percentage nonzero weights: 6.094183 
Average number of links: 4.631579 
Link number distribution:

 1  2  3  4  5  6  7  8  9 
 1  5 17 15 17 10  5  4  2 
1 least connected region:
70 with 1 link
2 most connected regions:
17 68 with 9 links
[1] "Summary for year 2018"
Neighbour list object:
Number of regions: 76 
Number of nonzero links: 352 
Percentage nonzero weights: 6.094183 
Average number of links: 4.631579 
Link number distribution:

 1  2  3  4  5  6  7  8  9 
 1  5 17 15 17 10  5  4  2 
1 least connected region:
70 with 1 link
2 most connected regions:
17 68 with 9 links
[1] "Summary for year 2019"
Neighbour list object:
Number of regions: 76 
Number of nonzero links: 352 
Percentage nonzero weights: 6.094183 
Average number of links: 4.631579 
Link number distribution:

 1  2  3  4  5  6  7  8  9 
 1  5 17 15 17 10  5  4  2 
1 least connected region:
70 with 1 link
2 most connected regions:
17 68 with 9 links
[1] "Summary for year 2020"
Neighbour list object:
Number of regions: 76 
Number of nonzero links: 352 
Percentage nonzero weights: 6.094183 
Average number of links: 4.631579 
Link number distribution:

 1  2  3  4  5  6  7  8  9 
 1  5 17 15 17 10  5  4  2 
1 least connected region:
70 with 1 link
2 most connected regions:
17 68 with 9 links
[1] "Summary for year 2021"
Neighbour list object:
Number of regions: 76 
Number of nonzero links: 352 
Percentage nonzero weights: 6.094183 
Average number of links: 4.631579 
Link number distribution:

 1  2  3  4  5  6  7  8  9 
 1  5 17 15 17 10  5  4  2 
1 least connected region:
70 with 1 link
2 most connected regions:
17 68 with 9 links
[1] "Summary for year 2022"
Neighbour list object:
Number of regions: 76 
Number of nonzero links: 352 
Percentage nonzero weights: 6.094183 
Average number of links: 4.631579 
Link number distribution:

 1  2  3  4  5  6  7  8  9 
 1  5 17 15 17 10  5  4  2 
1 least connected region:
70 with 1 link
2 most connected regions:
17 68 with 9 links</code></pre>
</div>
</div>
<p>Now, let’s calculate the Weights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>yearly_listw_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  wm_q <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  rswm_q <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(wm_q, <span class="at">style=</span><span class="st">"W"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  yearly_listw_data[[year]] <span class="ot">&lt;-</span> rswm_q</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Weight object for year"</span>, year))</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(rswm_q)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Weight object for year 2017"
[[1]]
[1] 0.3333333 0.3333333 0.3333333

[[2]]
[1] 0.25 0.25 0.25 0.25

[[3]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[4]]
[1] 0.3333333 0.3333333 0.3333333

[[5]]
[1] 0.2 0.2 0.2 0.2 0.2

[[6]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[7]]
[1] 0.25 0.25 0.25 0.25

[[8]]
[1] 0.25 0.25 0.25 0.25

[[9]]
[1] 0.2 0.2 0.2 0.2 0.2

[[10]]
[1] 0.2 0.2 0.2 0.2 0.2

[[11]]
[1] 0.3333333 0.3333333 0.3333333

[[12]]
[1] 0.3333333 0.3333333 0.3333333

[[13]]
[1] 0.3333333 0.3333333 0.3333333

[[14]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[15]]
[1] 0.2 0.2 0.2 0.2 0.2

[[16]]
[1] 0.2 0.2 0.2 0.2 0.2

[[17]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[18]]
[1] 0.25 0.25 0.25 0.25

[[19]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[20]]
[1] 0.3333333 0.3333333 0.3333333

[[21]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[22]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[23]]
[1] 0.5 0.5

[[24]]
[1] 0.2 0.2 0.2 0.2 0.2

[[25]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[26]]
[1] 0.2 0.2 0.2 0.2 0.2

[[27]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[28]]
[1] 0.3333333 0.3333333 0.3333333

[[29]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[30]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[31]]
[1] 0.2 0.2 0.2 0.2 0.2

[[32]]
[1] 0.3333333 0.3333333 0.3333333

[[33]]
[1] 0.5 0.5

[[34]]
[1] 0.3333333 0.3333333 0.3333333

[[35]]
[1] 0.25 0.25 0.25 0.25

[[36]]
[1] 0.25 0.25 0.25 0.25

[[37]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[38]]
[1] 0.3333333 0.3333333 0.3333333

[[39]]
[1] 0.3333333 0.3333333 0.3333333

[[40]]
[1] 0.25 0.25 0.25 0.25

[[41]]
[1] 0.25 0.25 0.25 0.25

[[42]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[43]]
[1] 0.3333333 0.3333333 0.3333333

[[44]]
[1] 0.25 0.25 0.25 0.25

[[45]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[46]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[47]]
[1] 0.2 0.2 0.2 0.2 0.2

[[48]]
[1] 0.25 0.25 0.25 0.25

[[49]]
[1] 0.5 0.5

[[50]]
[1] 0.3333333 0.3333333 0.3333333

[[51]]
[1] 0.2 0.2 0.2 0.2 0.2

[[52]]
[1] 0.5 0.5

[[53]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[54]]
[1] 0.2 0.2 0.2 0.2 0.2

[[55]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[56]]
[1] 0.5 0.5

[[57]]
[1] 0.25 0.25 0.25 0.25

[[58]]
[1] 0.3333333 0.3333333 0.3333333

[[59]]
[1] 0.2 0.2 0.2 0.2 0.2

[[60]]
[1] 0.3333333 0.3333333 0.3333333

[[61]]
[1] 0.25 0.25 0.25 0.25

[[62]]
[1] 0.2 0.2 0.2 0.2 0.2

[[63]]
[1] 0.2 0.2 0.2 0.2 0.2

[[64]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[65]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[66]]
[1] 0.2 0.2 0.2 0.2 0.2

[[67]]
[1] 0.25 0.25 0.25 0.25

[[68]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[69]]
[1] 0.25 0.25 0.25 0.25

[[70]]
[1] 1

[[71]]
[1] 0.3333333 0.3333333 0.3333333

[[72]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[73]]
[1] 0.2 0.2 0.2 0.2 0.2

[[74]]
[1] 0.25 0.25 0.25 0.25

[[75]]
[1] 0.3333333 0.3333333 0.3333333

[[76]]
[1] 0.2 0.2 0.2 0.2 0.2

attr(,"mode")
[1] "binary"
attr(,"W")
[1] TRUE
attr(,"comp")
attr(,"comp")$d
 [1] 3 4 6 3 5 8 4 4 5 5 3 3 3 6 5 5 9 4 7 3 6 8 2 5 6 5 7 3 8 8 5 3 2 3 4 4 6 3
[39] 3 4 4 7 3 4 6 7 5 4 2 3 5 2 6 5 6 2 4 3 5 3 4 5 5 6 7 5 4 9 4 1 3 6 5 4 3 5

[1] "Weight object for year 2018"
[[1]]
[1] 0.3333333 0.3333333 0.3333333

[[2]]
[1] 0.25 0.25 0.25 0.25

[[3]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[4]]
[1] 0.3333333 0.3333333 0.3333333

[[5]]
[1] 0.2 0.2 0.2 0.2 0.2

[[6]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[7]]
[1] 0.25 0.25 0.25 0.25

[[8]]
[1] 0.25 0.25 0.25 0.25

[[9]]
[1] 0.2 0.2 0.2 0.2 0.2

[[10]]
[1] 0.2 0.2 0.2 0.2 0.2

[[11]]
[1] 0.3333333 0.3333333 0.3333333

[[12]]
[1] 0.3333333 0.3333333 0.3333333

[[13]]
[1] 0.3333333 0.3333333 0.3333333

[[14]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[15]]
[1] 0.2 0.2 0.2 0.2 0.2

[[16]]
[1] 0.2 0.2 0.2 0.2 0.2

[[17]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[18]]
[1] 0.25 0.25 0.25 0.25

[[19]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[20]]
[1] 0.3333333 0.3333333 0.3333333

[[21]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[22]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[23]]
[1] 0.5 0.5

[[24]]
[1] 0.2 0.2 0.2 0.2 0.2

[[25]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[26]]
[1] 0.2 0.2 0.2 0.2 0.2

[[27]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[28]]
[1] 0.3333333 0.3333333 0.3333333

[[29]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[30]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[31]]
[1] 0.2 0.2 0.2 0.2 0.2

[[32]]
[1] 0.3333333 0.3333333 0.3333333

[[33]]
[1] 0.5 0.5

[[34]]
[1] 0.3333333 0.3333333 0.3333333

[[35]]
[1] 0.25 0.25 0.25 0.25

[[36]]
[1] 0.25 0.25 0.25 0.25

[[37]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[38]]
[1] 0.3333333 0.3333333 0.3333333

[[39]]
[1] 0.3333333 0.3333333 0.3333333

[[40]]
[1] 0.25 0.25 0.25 0.25

[[41]]
[1] 0.25 0.25 0.25 0.25

[[42]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[43]]
[1] 0.3333333 0.3333333 0.3333333

[[44]]
[1] 0.25 0.25 0.25 0.25

[[45]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[46]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[47]]
[1] 0.2 0.2 0.2 0.2 0.2

[[48]]
[1] 0.25 0.25 0.25 0.25

[[49]]
[1] 0.5 0.5

[[50]]
[1] 0.3333333 0.3333333 0.3333333

[[51]]
[1] 0.2 0.2 0.2 0.2 0.2

[[52]]
[1] 0.5 0.5

[[53]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[54]]
[1] 0.2 0.2 0.2 0.2 0.2

[[55]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[56]]
[1] 0.5 0.5

[[57]]
[1] 0.25 0.25 0.25 0.25

[[58]]
[1] 0.3333333 0.3333333 0.3333333

[[59]]
[1] 0.2 0.2 0.2 0.2 0.2

[[60]]
[1] 0.3333333 0.3333333 0.3333333

[[61]]
[1] 0.25 0.25 0.25 0.25

[[62]]
[1] 0.2 0.2 0.2 0.2 0.2

[[63]]
[1] 0.2 0.2 0.2 0.2 0.2

[[64]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[65]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[66]]
[1] 0.2 0.2 0.2 0.2 0.2

[[67]]
[1] 0.25 0.25 0.25 0.25

[[68]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[69]]
[1] 0.25 0.25 0.25 0.25

[[70]]
[1] 1

[[71]]
[1] 0.3333333 0.3333333 0.3333333

[[72]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[73]]
[1] 0.2 0.2 0.2 0.2 0.2

[[74]]
[1] 0.25 0.25 0.25 0.25

[[75]]
[1] 0.3333333 0.3333333 0.3333333

[[76]]
[1] 0.2 0.2 0.2 0.2 0.2

attr(,"mode")
[1] "binary"
attr(,"W")
[1] TRUE
attr(,"comp")
attr(,"comp")$d
 [1] 3 4 6 3 5 8 4 4 5 5 3 3 3 6 5 5 9 4 7 3 6 8 2 5 6 5 7 3 8 8 5 3 2 3 4 4 6 3
[39] 3 4 4 7 3 4 6 7 5 4 2 3 5 2 6 5 6 2 4 3 5 3 4 5 5 6 7 5 4 9 4 1 3 6 5 4 3 5

[1] "Weight object for year 2019"
[[1]]
[1] 0.3333333 0.3333333 0.3333333

[[2]]
[1] 0.25 0.25 0.25 0.25

[[3]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[4]]
[1] 0.3333333 0.3333333 0.3333333

[[5]]
[1] 0.2 0.2 0.2 0.2 0.2

[[6]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[7]]
[1] 0.25 0.25 0.25 0.25

[[8]]
[1] 0.25 0.25 0.25 0.25

[[9]]
[1] 0.2 0.2 0.2 0.2 0.2

[[10]]
[1] 0.2 0.2 0.2 0.2 0.2

[[11]]
[1] 0.3333333 0.3333333 0.3333333

[[12]]
[1] 0.3333333 0.3333333 0.3333333

[[13]]
[1] 0.3333333 0.3333333 0.3333333

[[14]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[15]]
[1] 0.2 0.2 0.2 0.2 0.2

[[16]]
[1] 0.2 0.2 0.2 0.2 0.2

[[17]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[18]]
[1] 0.25 0.25 0.25 0.25

[[19]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[20]]
[1] 0.3333333 0.3333333 0.3333333

[[21]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[22]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[23]]
[1] 0.5 0.5

[[24]]
[1] 0.2 0.2 0.2 0.2 0.2

[[25]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[26]]
[1] 0.2 0.2 0.2 0.2 0.2

[[27]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[28]]
[1] 0.3333333 0.3333333 0.3333333

[[29]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[30]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[31]]
[1] 0.2 0.2 0.2 0.2 0.2

[[32]]
[1] 0.3333333 0.3333333 0.3333333

[[33]]
[1] 0.5 0.5

[[34]]
[1] 0.3333333 0.3333333 0.3333333

[[35]]
[1] 0.25 0.25 0.25 0.25

[[36]]
[1] 0.25 0.25 0.25 0.25

[[37]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[38]]
[1] 0.3333333 0.3333333 0.3333333

[[39]]
[1] 0.3333333 0.3333333 0.3333333

[[40]]
[1] 0.25 0.25 0.25 0.25

[[41]]
[1] 0.25 0.25 0.25 0.25

[[42]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[43]]
[1] 0.3333333 0.3333333 0.3333333

[[44]]
[1] 0.25 0.25 0.25 0.25

[[45]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[46]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[47]]
[1] 0.2 0.2 0.2 0.2 0.2

[[48]]
[1] 0.25 0.25 0.25 0.25

[[49]]
[1] 0.5 0.5

[[50]]
[1] 0.3333333 0.3333333 0.3333333

[[51]]
[1] 0.2 0.2 0.2 0.2 0.2

[[52]]
[1] 0.5 0.5

[[53]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[54]]
[1] 0.2 0.2 0.2 0.2 0.2

[[55]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[56]]
[1] 0.5 0.5

[[57]]
[1] 0.25 0.25 0.25 0.25

[[58]]
[1] 0.3333333 0.3333333 0.3333333

[[59]]
[1] 0.2 0.2 0.2 0.2 0.2

[[60]]
[1] 0.3333333 0.3333333 0.3333333

[[61]]
[1] 0.25 0.25 0.25 0.25

[[62]]
[1] 0.2 0.2 0.2 0.2 0.2

[[63]]
[1] 0.2 0.2 0.2 0.2 0.2

[[64]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[65]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[66]]
[1] 0.2 0.2 0.2 0.2 0.2

[[67]]
[1] 0.25 0.25 0.25 0.25

[[68]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[69]]
[1] 0.25 0.25 0.25 0.25

[[70]]
[1] 1

[[71]]
[1] 0.3333333 0.3333333 0.3333333

[[72]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[73]]
[1] 0.2 0.2 0.2 0.2 0.2

[[74]]
[1] 0.25 0.25 0.25 0.25

[[75]]
[1] 0.3333333 0.3333333 0.3333333

[[76]]
[1] 0.2 0.2 0.2 0.2 0.2

attr(,"mode")
[1] "binary"
attr(,"W")
[1] TRUE
attr(,"comp")
attr(,"comp")$d
 [1] 3 4 6 3 5 8 4 4 5 5 3 3 3 6 5 5 9 4 7 3 6 8 2 5 6 5 7 3 8 8 5 3 2 3 4 4 6 3
[39] 3 4 4 7 3 4 6 7 5 4 2 3 5 2 6 5 6 2 4 3 5 3 4 5 5 6 7 5 4 9 4 1 3 6 5 4 3 5

[1] "Weight object for year 2020"
[[1]]
[1] 0.3333333 0.3333333 0.3333333

[[2]]
[1] 0.25 0.25 0.25 0.25

[[3]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[4]]
[1] 0.3333333 0.3333333 0.3333333

[[5]]
[1] 0.2 0.2 0.2 0.2 0.2

[[6]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[7]]
[1] 0.25 0.25 0.25 0.25

[[8]]
[1] 0.25 0.25 0.25 0.25

[[9]]
[1] 0.2 0.2 0.2 0.2 0.2

[[10]]
[1] 0.2 0.2 0.2 0.2 0.2

[[11]]
[1] 0.3333333 0.3333333 0.3333333

[[12]]
[1] 0.3333333 0.3333333 0.3333333

[[13]]
[1] 0.3333333 0.3333333 0.3333333

[[14]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[15]]
[1] 0.2 0.2 0.2 0.2 0.2

[[16]]
[1] 0.2 0.2 0.2 0.2 0.2

[[17]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[18]]
[1] 0.25 0.25 0.25 0.25

[[19]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[20]]
[1] 0.3333333 0.3333333 0.3333333

[[21]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[22]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[23]]
[1] 0.5 0.5

[[24]]
[1] 0.2 0.2 0.2 0.2 0.2

[[25]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[26]]
[1] 0.2 0.2 0.2 0.2 0.2

[[27]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[28]]
[1] 0.3333333 0.3333333 0.3333333

[[29]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[30]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[31]]
[1] 0.2 0.2 0.2 0.2 0.2

[[32]]
[1] 0.3333333 0.3333333 0.3333333

[[33]]
[1] 0.5 0.5

[[34]]
[1] 0.3333333 0.3333333 0.3333333

[[35]]
[1] 0.25 0.25 0.25 0.25

[[36]]
[1] 0.25 0.25 0.25 0.25

[[37]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[38]]
[1] 0.3333333 0.3333333 0.3333333

[[39]]
[1] 0.3333333 0.3333333 0.3333333

[[40]]
[1] 0.25 0.25 0.25 0.25

[[41]]
[1] 0.25 0.25 0.25 0.25

[[42]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[43]]
[1] 0.3333333 0.3333333 0.3333333

[[44]]
[1] 0.25 0.25 0.25 0.25

[[45]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[46]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[47]]
[1] 0.2 0.2 0.2 0.2 0.2

[[48]]
[1] 0.25 0.25 0.25 0.25

[[49]]
[1] 0.5 0.5

[[50]]
[1] 0.3333333 0.3333333 0.3333333

[[51]]
[1] 0.2 0.2 0.2 0.2 0.2

[[52]]
[1] 0.5 0.5

[[53]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[54]]
[1] 0.2 0.2 0.2 0.2 0.2

[[55]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[56]]
[1] 0.5 0.5

[[57]]
[1] 0.25 0.25 0.25 0.25

[[58]]
[1] 0.3333333 0.3333333 0.3333333

[[59]]
[1] 0.2 0.2 0.2 0.2 0.2

[[60]]
[1] 0.3333333 0.3333333 0.3333333

[[61]]
[1] 0.25 0.25 0.25 0.25

[[62]]
[1] 0.2 0.2 0.2 0.2 0.2

[[63]]
[1] 0.2 0.2 0.2 0.2 0.2

[[64]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[65]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[66]]
[1] 0.2 0.2 0.2 0.2 0.2

[[67]]
[1] 0.25 0.25 0.25 0.25

[[68]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[69]]
[1] 0.25 0.25 0.25 0.25

[[70]]
[1] 1

[[71]]
[1] 0.3333333 0.3333333 0.3333333

[[72]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[73]]
[1] 0.2 0.2 0.2 0.2 0.2

[[74]]
[1] 0.25 0.25 0.25 0.25

[[75]]
[1] 0.3333333 0.3333333 0.3333333

[[76]]
[1] 0.2 0.2 0.2 0.2 0.2

attr(,"mode")
[1] "binary"
attr(,"W")
[1] TRUE
attr(,"comp")
attr(,"comp")$d
 [1] 3 4 6 3 5 8 4 4 5 5 3 3 3 6 5 5 9 4 7 3 6 8 2 5 6 5 7 3 8 8 5 3 2 3 4 4 6 3
[39] 3 4 4 7 3 4 6 7 5 4 2 3 5 2 6 5 6 2 4 3 5 3 4 5 5 6 7 5 4 9 4 1 3 6 5 4 3 5

[1] "Weight object for year 2021"
[[1]]
[1] 0.3333333 0.3333333 0.3333333

[[2]]
[1] 0.25 0.25 0.25 0.25

[[3]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[4]]
[1] 0.3333333 0.3333333 0.3333333

[[5]]
[1] 0.2 0.2 0.2 0.2 0.2

[[6]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[7]]
[1] 0.25 0.25 0.25 0.25

[[8]]
[1] 0.25 0.25 0.25 0.25

[[9]]
[1] 0.2 0.2 0.2 0.2 0.2

[[10]]
[1] 0.2 0.2 0.2 0.2 0.2

[[11]]
[1] 0.3333333 0.3333333 0.3333333

[[12]]
[1] 0.3333333 0.3333333 0.3333333

[[13]]
[1] 0.3333333 0.3333333 0.3333333

[[14]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[15]]
[1] 0.2 0.2 0.2 0.2 0.2

[[16]]
[1] 0.2 0.2 0.2 0.2 0.2

[[17]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[18]]
[1] 0.25 0.25 0.25 0.25

[[19]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[20]]
[1] 0.3333333 0.3333333 0.3333333

[[21]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[22]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[23]]
[1] 0.5 0.5

[[24]]
[1] 0.2 0.2 0.2 0.2 0.2

[[25]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[26]]
[1] 0.2 0.2 0.2 0.2 0.2

[[27]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[28]]
[1] 0.3333333 0.3333333 0.3333333

[[29]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[30]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[31]]
[1] 0.2 0.2 0.2 0.2 0.2

[[32]]
[1] 0.3333333 0.3333333 0.3333333

[[33]]
[1] 0.5 0.5

[[34]]
[1] 0.3333333 0.3333333 0.3333333

[[35]]
[1] 0.25 0.25 0.25 0.25

[[36]]
[1] 0.25 0.25 0.25 0.25

[[37]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[38]]
[1] 0.3333333 0.3333333 0.3333333

[[39]]
[1] 0.3333333 0.3333333 0.3333333

[[40]]
[1] 0.25 0.25 0.25 0.25

[[41]]
[1] 0.25 0.25 0.25 0.25

[[42]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[43]]
[1] 0.3333333 0.3333333 0.3333333

[[44]]
[1] 0.25 0.25 0.25 0.25

[[45]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[46]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[47]]
[1] 0.2 0.2 0.2 0.2 0.2

[[48]]
[1] 0.25 0.25 0.25 0.25

[[49]]
[1] 0.5 0.5

[[50]]
[1] 0.3333333 0.3333333 0.3333333

[[51]]
[1] 0.2 0.2 0.2 0.2 0.2

[[52]]
[1] 0.5 0.5

[[53]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[54]]
[1] 0.2 0.2 0.2 0.2 0.2

[[55]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[56]]
[1] 0.5 0.5

[[57]]
[1] 0.25 0.25 0.25 0.25

[[58]]
[1] 0.3333333 0.3333333 0.3333333

[[59]]
[1] 0.2 0.2 0.2 0.2 0.2

[[60]]
[1] 0.3333333 0.3333333 0.3333333

[[61]]
[1] 0.25 0.25 0.25 0.25

[[62]]
[1] 0.2 0.2 0.2 0.2 0.2

[[63]]
[1] 0.2 0.2 0.2 0.2 0.2

[[64]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[65]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[66]]
[1] 0.2 0.2 0.2 0.2 0.2

[[67]]
[1] 0.25 0.25 0.25 0.25

[[68]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[69]]
[1] 0.25 0.25 0.25 0.25

[[70]]
[1] 1

[[71]]
[1] 0.3333333 0.3333333 0.3333333

[[72]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[73]]
[1] 0.2 0.2 0.2 0.2 0.2

[[74]]
[1] 0.25 0.25 0.25 0.25

[[75]]
[1] 0.3333333 0.3333333 0.3333333

[[76]]
[1] 0.2 0.2 0.2 0.2 0.2

attr(,"mode")
[1] "binary"
attr(,"W")
[1] TRUE
attr(,"comp")
attr(,"comp")$d
 [1] 3 4 6 3 5 8 4 4 5 5 3 3 3 6 5 5 9 4 7 3 6 8 2 5 6 5 7 3 8 8 5 3 2 3 4 4 6 3
[39] 3 4 4 7 3 4 6 7 5 4 2 3 5 2 6 5 6 2 4 3 5 3 4 5 5 6 7 5 4 9 4 1 3 6 5 4 3 5

[1] "Weight object for year 2022"
[[1]]
[1] 0.3333333 0.3333333 0.3333333

[[2]]
[1] 0.25 0.25 0.25 0.25

[[3]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[4]]
[1] 0.3333333 0.3333333 0.3333333

[[5]]
[1] 0.2 0.2 0.2 0.2 0.2

[[6]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[7]]
[1] 0.25 0.25 0.25 0.25

[[8]]
[1] 0.25 0.25 0.25 0.25

[[9]]
[1] 0.2 0.2 0.2 0.2 0.2

[[10]]
[1] 0.2 0.2 0.2 0.2 0.2

[[11]]
[1] 0.3333333 0.3333333 0.3333333

[[12]]
[1] 0.3333333 0.3333333 0.3333333

[[13]]
[1] 0.3333333 0.3333333 0.3333333

[[14]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[15]]
[1] 0.2 0.2 0.2 0.2 0.2

[[16]]
[1] 0.2 0.2 0.2 0.2 0.2

[[17]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[18]]
[1] 0.25 0.25 0.25 0.25

[[19]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[20]]
[1] 0.3333333 0.3333333 0.3333333

[[21]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[22]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[23]]
[1] 0.5 0.5

[[24]]
[1] 0.2 0.2 0.2 0.2 0.2

[[25]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[26]]
[1] 0.2 0.2 0.2 0.2 0.2

[[27]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[28]]
[1] 0.3333333 0.3333333 0.3333333

[[29]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[30]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[31]]
[1] 0.2 0.2 0.2 0.2 0.2

[[32]]
[1] 0.3333333 0.3333333 0.3333333

[[33]]
[1] 0.5 0.5

[[34]]
[1] 0.3333333 0.3333333 0.3333333

[[35]]
[1] 0.25 0.25 0.25 0.25

[[36]]
[1] 0.25 0.25 0.25 0.25

[[37]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[38]]
[1] 0.3333333 0.3333333 0.3333333

[[39]]
[1] 0.3333333 0.3333333 0.3333333

[[40]]
[1] 0.25 0.25 0.25 0.25

[[41]]
[1] 0.25 0.25 0.25 0.25

[[42]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[43]]
[1] 0.3333333 0.3333333 0.3333333

[[44]]
[1] 0.25 0.25 0.25 0.25

[[45]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[46]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[47]]
[1] 0.2 0.2 0.2 0.2 0.2

[[48]]
[1] 0.25 0.25 0.25 0.25

[[49]]
[1] 0.5 0.5

[[50]]
[1] 0.3333333 0.3333333 0.3333333

[[51]]
[1] 0.2 0.2 0.2 0.2 0.2

[[52]]
[1] 0.5 0.5

[[53]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[54]]
[1] 0.2 0.2 0.2 0.2 0.2

[[55]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[56]]
[1] 0.5 0.5

[[57]]
[1] 0.25 0.25 0.25 0.25

[[58]]
[1] 0.3333333 0.3333333 0.3333333

[[59]]
[1] 0.2 0.2 0.2 0.2 0.2

[[60]]
[1] 0.3333333 0.3333333 0.3333333

[[61]]
[1] 0.25 0.25 0.25 0.25

[[62]]
[1] 0.2 0.2 0.2 0.2 0.2

[[63]]
[1] 0.2 0.2 0.2 0.2 0.2

[[64]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[65]]
[1] 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571 0.1428571

[[66]]
[1] 0.2 0.2 0.2 0.2 0.2

[[67]]
[1] 0.25 0.25 0.25 0.25

[[68]]
[1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111
[8] 0.1111111 0.1111111

[[69]]
[1] 0.25 0.25 0.25 0.25

[[70]]
[1] 1

[[71]]
[1] 0.3333333 0.3333333 0.3333333

[[72]]
[1] 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667 0.1666667

[[73]]
[1] 0.2 0.2 0.2 0.2 0.2

[[74]]
[1] 0.25 0.25 0.25 0.25

[[75]]
[1] 0.3333333 0.3333333 0.3333333

[[76]]
[1] 0.2 0.2 0.2 0.2 0.2

attr(,"mode")
[1] "binary"
attr(,"W")
[1] TRUE
attr(,"comp")
attr(,"comp")$d
 [1] 3 4 6 3 5 8 4 4 5 5 3 3 3 6 5 5 9 4 7 3 6 8 2 5 6 5 7 3 8 8 5 3 2 3 4 4 6 3
[39] 3 4 4 7 3 4 6 7 5 4 2 3 5 2 6 5 6 2 4 3 5 3 4 5 5 6 7 5 4 9 4 1 3 6 5 4 3 5</code></pre>
</div>
</div>
</section>
<section id="global-measures-of-spatial-autocorrelation-morans-i" class="level2">
<h2 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation-morans-i">5.2 Global Measures of Spatial Autocorrelation: Moran’s I</h2>
<p>The code performs Global Moran’s I tests to measure spatial autocorrelation of drug offense cases for each year. For each year, it filters the data and calculates Moran’s I using neighborhood weights and adjacency relations. The Moran’s I statistic assesses whether high or low values of drug offense cases are clustered spatially or randomly distributed. The results for each year are stored in a list, providing insight into the spatial patterns of drug offenses over time.</p>
<p>global_moran() of the sfdep package is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>moran_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  moran_test_result <span class="ot">&lt;-</span> <span class="fu">global_moran</span>(var, nb, wt)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  moran_results[[year]] <span class="ot">&lt;-</span> moran_test_result</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Moran's I test result for year"</span>, year))</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(moran_test_result)</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Moran's I test result for year 2017"
$I
[1] 0.1354189

$K
[1] 31.86389

[1] "Moran's I test result for year 2018"
$I
[1] 0.1176243

$K
[1] 30.48278

[1] "Moran's I test result for year 2019"
$I
[1] 0.1567233

$K
[1] 18.84897

[1] "Moran's I test result for year 2020"
$I
[1] 0.1317174

$K
[1] 12.50041

[1] "Moran's I test result for year 2021"
$I
[1] 0.2003025

$K
[1] 5.552669

[1] "Moran's I test result for year 2022"
$I
[1] 0.2016508

$K
[1] 3.308794</code></pre>
</div>
</div>
<p>Positive Moran’s I values indicate a tendency for similar values (in this case, total_cases) to cluster in space, suggesting spatial autocorrelation. Significant p-values (typically less than 0.05) indicate that the observed spatial autocorrelation is statistically significant. All years showed significant results, suggesting consistent clustering of drug offense cases over the years analyzed.</p>
<p>This indicates that areas with high (or low) levels of drug offenses tend to be spatially clustered, rather than randomly distributed.</p>
<p>The Moran’s I values increase over the years, particularly in 2021 (0.200) and 2022 (0.201), suggesting that clustering of similar drug offense levels became stronger in the later years. The values of K, representing the total number of cases, decrease over time, possibly indicating fewer drug offenses, but more pronounced spatial clustering as the years progress. The increasing Moran’s I values suggest a growing spatial pattern of clustering in drug-related activity.</p>
<section id="computing-and-visualising-global-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="computing-and-visualising-global-morans-i">5.2.1 Computing and Visualising Global Moran’s I</h3>
<p>The Global Moran’s I test, which can be implemented using the global_moran_test() function from the sfdep package, is a method for testing spatial autocorrelation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>moran_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  moran_test_result <span class="ot">&lt;-</span> <span class="fu">global_moran_test</span>(var,</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>                  nb,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>                  wt,</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  moran_results[[year]] <span class="ot">&lt;-</span> moran_test_result</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Global Moran's I test result for year"</span>, year))</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(moran_test_result)</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Global Moran's I test result for year 2017"

    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 2.5108, p-value = 0.006023
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.135418891      -0.013333333       0.003510047 

[1] "Global Moran's I test result for year 2018"

    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 2.1753, p-value = 0.0148
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.117624349      -0.013333333       0.003624168 

[1] "Global Moran's I test result for year 2019"

    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 2.5113, p-value = 0.006014
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.156723319      -0.013333333       0.004585464 

[1] "Global Moran's I test result for year 2020"

    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 2.0291, p-value = 0.02122
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.131717406      -0.013333333       0.005110044 

[1] "Global Moran's I test result for year 2021"

    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 2.8336, p-value = 0.002301
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.200302477      -0.013333333       0.005684132 

[1] "Global Moran's I test result for year 2022"

    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 2.8061, p-value = 0.002507
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.201650830      -0.013333333       0.005869543 </code></pre>
</div>
</div>
<p>Given that the p-value is much smaller than common significance levels (e.g., 0.05 or 0.01), we reject the null hypothesis of no spatial autocorrelation. This means that there is statistically significant evidence to suggest that the total_cases variable is spatially correlated in the regions analyzed.</p>
<p>The positive Moran’s I statistic indicates that areas with higher counts of total cases are likely to be located near each other, suggesting a clustering effect. This can imply that factors leading to higher cases are spatially concentrated in certain regions.</p>
<p>The consistency of the Moran’s I statistic, standard deviate, and p-value across all years from 2017 to 2022 indicates that the spatial autocorrelation of total_cases has persisted over time. This could point to ongoing or systematic issues related to drug offenses in specific areas. ### 5.2.2 Performing Global Moran’s permutation test The Global Moran’s permutation test was conducted for each year between 2017 and 2022 using 999 simulations to assess the significance of spatial autocorrelation in drug offense cases across Thailand. By comparing observed Moran’s I values to a reference distribution generated through random permutations, the test provides a more robust measure of spatial clustering. The results, stored in gmoranMC_results, help to validate the significance of the observed spatial patterns and determine if the clustering of high or low drug offense cases is due to random chance or a real spatial process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>gmoranMC_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  gmoranMCresult <span class="ot">&lt;-</span> <span class="fu">global_moran_perm</span>(var,</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>                  nb,</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>                  wt,</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  gmoranMC_results[[year]] <span class="ot">&lt;-</span> gmoranMCresult</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Global Moran's I test result for year"</span>, year))</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(gmoranMCresult)</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Global Moran's I test result for year 2017"

    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.13542, observed rank = 982, p-value = 0.036
alternative hypothesis: two.sided

[1] "Global Moran's I test result for year 2018"

    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.11762, observed rank = 953, p-value = 0.094
alternative hypothesis: two.sided

[1] "Global Moran's I test result for year 2019"

    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.15672, observed rank = 987, p-value = 0.026
alternative hypothesis: two.sided

[1] "Global Moran's I test result for year 2020"

    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.13172, observed rank = 964, p-value = 0.072
alternative hypothesis: two.sided

[1] "Global Moran's I test result for year 2021"

    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.2003, observed rank = 998, p-value = 0.004
alternative hypothesis: two.sided

[1] "Global Moran's I test result for year 2022"

    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.20165, observed rank = 997, p-value = 0.006
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>Stronger significance is observed in 2019, 2021, and 2022, suggesting clustering of drug offenses. 2018 and 2020 show weaker evidence of spatial clustering.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  gmoranMC <span class="ot">&lt;-</span> gmoranMC_results[[year]]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(gmoranMC<span class="sc">$</span>res, <span class="at">main=</span><span class="st">"Histogram of Global Moran's I Monte-Carlo Simulation Results"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> gmoranMC<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-26-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-26-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-26-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-26-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation-gearys-c" class="level2">
<h2 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation-gearys-c">5.3 Global Measures of Spatial Autocorrelation: Geary’s C</h2>
<p>In this section, we would be computing Geary’s C statistics testing by using appropriate functions of spdep package.</p>
<section id="gearys-c-test" class="level3">
<h3 class="anchored" data-anchor-id="gearys-c-test">5.3.1 Geary’s C test</h3>
<p>The code chunk below performs Geary’s C test for spatial autocorrelation by using the global_c_test() function from the sfdep package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>yearly_globalCgeary_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  globalgearyc <span class="ot">&lt;-</span> <span class="fu">global_c_test</span>(var,</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>                  nb,</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>                  wt,</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  yearly_globalCgeary_results[[year]] <span class="ot">&lt;-</span> globalgearyc</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(year)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(globalgearyc)</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017"

    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = -0.014472, p-value = 0.5058
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
       1.00202655        1.00000000        0.01960931 

[1] "2018"

    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = -0.047587, p-value = 0.519
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
       1.00655870        1.00000000        0.01899593 

[1] "2019"

    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = 0.55819, p-value = 0.2884
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
       0.93435798        1.00000000        0.01382906 

[1] "2020"

    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = 0.4331, p-value = 0.3325
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
        0.9545560         1.0000000         0.0110095 

[1] "2021"

    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = 1.4864, p-value = 0.06859
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
      0.867690991       1.000000000       0.007923839 

[1] "2022"

    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = 1.7369, p-value = 0.0412
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
      0.855439054       1.000000000       0.006927278 </code></pre>
</div>
</div>
<p>General Interpretation of Geary’s C: Geary’s C statistic values close to 1 suggest no spatial autocorrelation (randomness in spatial data). Values less than 1 indicate positive spatial autocorrelation (neighboring areas have similar values), meaning that nearby regions tend to have similar drug offense totals. Values greater than 1 suggest negative spatial autocorrelation (neighboring areas have dissimilar values), meaning that nearby regions tend to have different drug offense totals.</p>
<p>Breakdown of Results: The Geary’s C test results for the years 2017 to 2022 provide an assessment of spatial autocorrelation, with a focus on local dissimilarities between neighboring regions:</p>
<p>2017: Geary’s C statistic is 1.002 with a p-value of 0.506, suggesting no significant spatial autocorrelation. 2018: Geary’s C statistic is 1.007 with a p-value of 0.519, indicating no significant spatial autocorrelation. 2019: Geary’s C statistic is 0.934 with a p-value of 0.288, showing no significant spatial autocorrelation. 2020: Geary’s C statistic is 0.955 with a p-value of 0.333, indicating no significant spatial autocorrelation. 2021: Geary’s C statistic is 0.868 with a p-value of 0.069, suggesting moderate spatial autocorrelation, significant at the 10% level. 2022: Geary’s C statistic is 0.855 with a p-value of 0.041, indicating significant spatial autocorrelation at the 5% level.</p>
<p>No strong spatial autocorrelation is found for most years, except for 2021 and 2022, where the data suggests positive spatial autocorrelation (regions with similar drug offense totals are likely to be near each other). The spatial pattern is particularly significant in 2022, where the p-value indicates that neighboring regions are likely to have similar drug offense totals, showing statistically significant spatial clustering. 2021 also shows potential clustering, with a p-value close to 0.05, suggesting a trend towards spatial autocorrelation.</p>
</section>
<section id="computing-monte-carlo-gearys-c" class="level3">
<h3 class="anchored" data-anchor-id="computing-monte-carlo-gearys-c">5.3.2 Computing Monte Carlo Geary’s C</h3>
<p>Monte Carlo simulations for Geary’s C statistic were performed for each year from 2017 to 2022, using 999 simulations. This approach provides a robust measure of local spatial autocorrelation by comparing observed dissimilarities between neighboring regions to a random distribution.</p>
<p>global_c_perm() of sfdep is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>yearly_geary_mc_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_listw_data)) {</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  geary_mc_test_result <span class="ot">&lt;-</span> <span class="fu">global_c_perm</span>(var,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>                  nb,</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>                  wt,</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  yearly_geary_mc_results[[year]] <span class="ot">&lt;-</span> geary_mc_test_result</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Geary's C Monte Carlo test result for year"</span>, year))</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(geary_mc_test_result)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Geary's C Monte Carlo test result for year 2017"

    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 1.002, observed rank = 545, p-value = 0.545
alternative hypothesis: greater

[1] "Geary's C Monte Carlo test result for year 2018"

    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 1.0066, observed rank = 545, p-value = 0.545
alternative hypothesis: greater

[1] "Geary's C Monte Carlo test result for year 2019"

    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.93436, observed rank = 308, p-value = 0.308
alternative hypothesis: greater

[1] "Geary's C Monte Carlo test result for year 2020"

    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.95456, observed rank = 332, p-value = 0.332
alternative hypothesis: greater

[1] "Geary's C Monte Carlo test result for year 2021"

    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.86769, observed rank = 63, p-value = 0.063
alternative hypothesis: greater

[1] "Geary's C Monte Carlo test result for year 2022"

    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.85544, observed rank = 50, p-value = 0.05
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>For years 2017, 2018, 2019, 2020: High p-values (&gt;0.05) indicate no significant evidence to reject the null hypothesis, suggesting no significant spatial clustering of total cases.</p>
<p>For year 2021: The p-value of 0.063 is still approaching significance, indicating some evidence of spatial clustering but not strong enough to conclude definitively.</p>
<p>For year 2022: The p-value of 0.05 is right at the significance threshold, suggesting a potential trend toward spatial clustering of total cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year in the yearly_geary_mc_results list</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_geary_mc_results)) {</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  bperm <span class="ot">&lt;-</span> yearly_geary_mc_results[[year]]</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  var_value <span class="ot">&lt;-</span> <span class="fu">var</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  summary_stats <span class="ot">&lt;-</span> <span class="fu">summary</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Summary statistics for year"</span>, year))</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(summary_stats)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(bperm<span class="sc">$</span>res, </span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">freq=</span><span class="cn">TRUE</span>, </span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks=</span><span class="dv">20</span>, </span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab=</span><span class="st">"Simulated Geary's C"</span>, </span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">main=</span><span class="fu">paste</span>(<span class="st">"Geary's C Monte Carlo Simulation -"</span>, year))</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a vertical line at 1</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary statistics for year 2017"
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5438  0.9079  0.9860  0.9961  1.0773  1.5022 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary statistics for year 2018"
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.6348  0.9039  0.9898  1.0003  1.0801  1.4806 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary statistics for year 2019"
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.6394  0.9222  0.9893  0.9976  1.0691  1.3836 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-29-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary statistics for year 2020"
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.6526  0.9293  0.9993  0.9979  1.0656  1.3817 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-29-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary statistics for year 2021"
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.7092  0.9422  1.0018  1.0020  1.0646  1.3447 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-29-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary statistics for year 2022"
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.7246  0.9482  1.0004  1.0009  1.0565  1.2596 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-29-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="local-measures-of-spatial-autocorrelation" class="level1">
<h1>6.0 Local Measures of Spatial Autocorrelation</h1>
<section id="computing-and-mapping-local-morans-i" class="level2">
<h2 class="anchored" data-anchor-id="computing-and-mapping-local-morans-i">6.1 Computing and Mapping local Moran’s I</h2>
<p>local_moran() function of sfdep package will be used for computing local Moran’s I.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>localMI_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  lisa <span class="ot">&lt;-</span> yearly_data <span class="sc">%&gt;%</span> </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">local_moran =</span> <span class="fu">local_moran</span>(</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>      var, nb, wt, <span class="at">nsim =</span> <span class="dv">99</span>),</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(local_moran)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(lisa)</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"ii"</span>, </span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">palette =</span> <span class="st">"RdBu"</span>, </span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Local Moran's I (Year:"</span>, year, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(map)</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 76 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 76 × 16
         ii      eii   var_ii   z_ii    p_ii p_ii_sim p_folded_sim skewness
      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1 -0.0281   0.00700 0.0251   -0.221 0.825       0.46         0.23    -3.01
 2  0.196    0.0530  0.0879    0.483 0.629       0.72         0.36    -2.12
 3  0.980   -0.447   3.38      0.776 0.438       0.38         0.19     1.39
 4  0.111    0.0261  0.0253    0.535 0.592       0.68         0.34    -2.53
 5  0.00169 -0.0178  0.0153    0.158 0.875       0.84         0.42    -1.58
 6  0.307   -0.00738 0.00942   3.24  0.00121     0.06         0.03     1.77
 7  0.355    0.0162  0.110     1.02  0.308       0.08         0.04    -2.51
 8 -0.00777  0.00753 0.000790 -0.545 0.586       0.52         0.26    -2.14
 9 -0.123    0.00131 0.0259   -0.774 0.439       0.3          0.15    -1.54
10 -0.389    0.219   0.541    -0.827 0.408       0.36         0.18     1.39
# ℹ 66 more rows
# ℹ 8 more variables: kurtosis &lt;dbl&gt;, mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;,
#   ADM1_EN &lt;chr&gt;, fiscal_year &lt;dbl&gt;, total_cases &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 76 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 76 × 16
         ii       eii    var_ii   z_ii      p_ii p_ii_sim p_folded_sim skewness
      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1 -0.0582   0.0227   0.0343    -0.437 0.662         0.5          0.25   -2.47 
 2  0.150    0.0262   0.115      0.365 0.715         0.88         0.44   -2.23 
 3  1.05    -0.659    2.65       1.05  0.294         0.34         0.17    0.737
 4  0.237   -0.0222   0.0992     0.822 0.411         0.24         0.12   -2.32 
 5 -0.00162 -0.000383 0.0000263 -0.242 0.809         0.48         0.24   -1.85 
 6 -0.0207   0.00106  0.0000306 -3.93  0.0000851     0.04         0.02   -1.75 
 7  0.395    0.0442   0.106      1.08  0.282         0.1          0.05   -2.34 
 8  0.104   -0.00263  0.0162     0.833 0.405         0.36         0.18    1.78 
 9 -0.0941   0.0318   0.0179    -0.940 0.347         0.26         0.13   -1.78 
10 -0.375   -0.0999   0.160     -0.689 0.491         0.46         0.23    1.94 
# ℹ 66 more rows
# ℹ 8 more variables: kurtosis &lt;dbl&gt;, mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;,
#   ADM1_EN &lt;chr&gt;, fiscal_year &lt;dbl&gt;, total_cases &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 76 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 76 × 16
        ii       eii   var_ii   z_ii    p_ii p_ii_sim p_folded_sim skewness
     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1 -0.0953  0.000190 0.0245   -0.610 0.542       0.38         0.19   -1.64 
 2  0.183   0.0482   0.133     0.371 0.711       0.94         0.47   -1.55 
 3  1.63   -0.841    1.93      1.78  0.0752      0.14         0.07    0.729
 4  0.297  -0.0566   0.153     0.902 0.367       0.18         0.09   -1.80 
 5  0.0957 -0.00163  0.0174    0.737 0.461       0.3          0.15    1.46 
 6 -0.0658 -0.000402 0.000506 -2.91  0.00365     0.06         0.03   -1.18 
 7  0.436  -0.0205   0.114     1.35  0.176       0.06         0.03   -1.42 
 8  0.282  -0.0396   0.0755    1.17  0.241       0.2          0.1     1.54 
 9 -0.0958 -0.0307   0.0533   -0.282 0.778       0.58         0.29   -1.91 
10 -0.468   0.0563   0.389    -0.841 0.400       0.32         0.16    1.09 
# ℹ 66 more rows
# ℹ 8 more variables: kurtosis &lt;dbl&gt;, mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;,
#   ADM1_EN &lt;chr&gt;, fiscal_year &lt;dbl&gt;, total_cases &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-30-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 76 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 76 × 16
         ii       eii   var_ii   z_ii   p_ii p_ii_sim p_folded_sim skewness
      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1 -0.117   -0.00352  0.114    -0.337 0.736      0.56         0.28   -0.885
 2  0.283   -0.0237   0.241     0.625 0.532      0.58         0.29   -1.58 
 3 -0.00844 -0.322    3.21      0.175 0.861      0.74         0.37    0.932
 4  0.129   -0.0178   0.0468    0.677 0.499      0.56         0.28   -1.67 
 5 -0.00813  0.00663  0.00815  -0.164 0.870      0.72         0.36   -1.04 
 6  0.0835  -0.000885 0.00116   2.47  0.0134     0.04         0.02    0.699
 7  0.516    0.00160  0.119     1.49  0.137      0.04         0.02   -0.899
 8 -0.00701 -0.00109  0.000169 -0.456 0.649      0.58         0.29   -1.06 
 9 -0.158    0.0145   0.0220   -1.16  0.244      0.3          0.15   -1.15 
10 -0.477   -0.0662   0.895    -0.434 0.664      0.88         0.44    1.17 
# ℹ 66 more rows
# ℹ 8 more variables: kurtosis &lt;dbl&gt;, mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;,
#   ADM1_EN &lt;chr&gt;, fiscal_year &lt;dbl&gt;, total_cases &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-30-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 76 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 76 × 16
        ii      eii  var_ii   z_ii  p_ii p_ii_sim p_folded_sim skewness kurtosis
     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 -0.177   0.00620 0.0156  -1.46  0.143     0.22         0.11   -0.917   0.841 
 2  0.519   0.0510  0.207    1.03  0.304     0.36         0.18   -0.816   0.245 
 3 -0.914  -0.171   1.37    -0.635 0.525     0.64         0.32    0.561  -0.0535
 4  0.0170 -0.00982 0.0209   0.186 0.852     0.98         0.49   -0.950   0.775 
 5  0.285  -0.0480  0.0619   1.34  0.180     0.18         0.09    0.624   0.147 
 6  0.0522 -0.0129  0.00302  1.19  0.236     0.26         0.13    0.616   0.0586
 7  0.810   0.0663  0.245    1.50  0.133     0.12         0.06   -0.491  -0.337 
 8  0.354   0.00421 0.0589   1.44  0.150     0.24         0.12    0.683  -0.0479
 9 -0.0558 -0.0118  0.0627  -0.176 0.860     0.74         0.37   -0.871   0.0420
10 -0.507  -0.0242  0.969   -0.490 0.624     0.8          0.4     0.411  -0.698 
# ℹ 66 more rows
# ℹ 7 more variables: mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;, ADM1_EN &lt;chr&gt;,
#   fiscal_year &lt;dbl&gt;, total_cases &lt;dbl&gt;, geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-30-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 76 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 76 × 16
         ii       eii var_ii    z_ii  p_ii p_ii_sim p_folded_sim skewness
      &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1 -0.135    0.000885 0.0548 -0.582  0.560     0.56         0.28  -0.127 
 2  0.435    0.0297   0.155   1.03   0.303     0.32         0.16  -0.437 
 3 -0.547   -0.0640   0.494  -0.688  0.492     0.54         0.27   0.446 
 4  0.115    0.00845  0.0170  0.816  0.414     0.46         0.23   0.477 
 5  0.350    0.0151   0.0691  1.27   0.203     0.22         0.11  -0.0674
 6  0.00966  0.00258  0.0124  0.0637 0.949     0.96         0.48  -0.288 
 7  0.812    0.0952   0.217   1.54   0.124     0.12         0.06  -0.0985
 8  0.503    0.0139   0.147   1.27   0.203     0.32         0.16   0.435 
 9  0.156    0.00394  0.0773  0.548  0.584     0.64         0.32  -0.0731
10 -0.231   -0.200    0.862  -0.0339 0.973     0.98         0.49   0.353 
# ℹ 66 more rows
# ℹ 8 more variables: kurtosis &lt;dbl&gt;, mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;,
#   ADM1_EN &lt;chr&gt;, fiscal_year &lt;dbl&gt;, total_cases &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "ii" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-30-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The maps reveal consistent spatial autocorrelation patterns over the three years, particularly highlighting Bangkok and southern Thailand as areas of strong positive clustering. Over time, the extent of provinces with strong spatial clustering appears to have slightly increased in 2019. The central and northern regions consistently show weaker spatial autocorrelation, with certain provinces exhibiting negative spatial autocorrelation values, reflecting spatial dissimilarity.</p>
<p>These maps suggest that there are persistent spatial patterns in drug offenses over time, with certain regions consistently exhibiting higher clustering.</p>
<p>Over the years from 2020 to 2022, there is a noticeable shift in drug offense spatial patterns: 2020: Spatial clustering was primarily concentrated in the south, around Bangkok. 2021: The focus shifts towards the northeast, indicating new regional clusters. 2022: The northeast becomes a significant area of high drug offenses, further reinforcing a shift in the spatial distribution pattern of offenses.</p>
<section id="mapping-the-local-morans-i-p-values" class="level3">
<h3 class="anchored" data-anchor-id="mapping-the-local-morans-i-p-values">6.1.1 Mapping the local Moran’s I p-values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_listw_data)) {</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  lisa <span class="ot">&lt;-</span> yearly_data <span class="sc">%&gt;%</span> </span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">local_moran =</span> <span class="fu">local_moran</span>(</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>      var, nb, wt, <span class="at">nsim =</span> <span class="dv">99</span>),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(local_moran)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Map for p-values of Local Moran's I</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>map_p_value <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"p_ii"</span>, </span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"YlGnBu"</span>,</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Local Moran's I p-values (Year:"</span>, year, <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(map_p_value)</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-31-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-31-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-31-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="creating-a-lisa-cluster-map" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-lisa-cluster-map">6.2 Creating a LISA Cluster Map</h2>
<p>The LISA Cluster Map shows the significant locations color coded by type of spatial autocorrelation. The first step before we can generate the LISA cluster map is to plot the Moran scatterplot.</p>
<section id="preparing-lisa-map-classes-and-plotting-lisa-map" class="level3">
<h3 class="anchored" data-anchor-id="preparing-lisa-map-classes-and-plotting-lisa-map">6.2.3 Preparing LISA map classes and Plotting LISA map</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate Local Moran's I</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  lisa <span class="ot">&lt;-</span> yearly_data <span class="sc">%&gt;%</span> </span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">local_moran =</span> <span class="fu">local_moran</span>(var, nb, wt, <span class="at">nsim =</span> <span class="dv">99</span>),</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(local_moran)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>  lisa_sig <span class="ot">&lt;-</span> lisa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_ii <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>  m1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_shape</span>(lisa_sig) <span class="sc">+</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_fill</span>(<span class="st">"p_ii"</span>, <span class="at">palette =</span> <span class="st">"PuOr"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"Local Moran's I - Significant (Year:"</span>, year, <span class="st">")"</span>))</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>  m2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa) <span class="sc">+</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_polygons</span>(<span class="st">"total_cases"</span>,  </span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">style =</span> <span class="st">"quantile"</span>, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste</span>(<span class="st">"Total Cases (Year:"</span>, year, <span class="st">")"</span>))</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">tmap_arrange</span>(m1, m2, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>))</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-32-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-32-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-32-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="hot-spot-and-cold-spot-area-analysis" class="level1">
<h1>7.0 Hot Spot and Cold Spot Area Analysis</h1>
<section id="getis-and-ords-g-statistics" class="level2">
<h2 class="anchored" data-anchor-id="getis-and-ords-g-statistics">7.1 Getis and Ord’s G-Statistics</h2>
<p>Getis and Ord’s G-Statistics looks at neighbours within a defined proximity to identify where either high or low values clutser spatially. Here, statistically significant hot-spots are recognised as areas of high values where other areas within a neighbourhood range also share high values too.</p>
<p>Positive Gi* values (purple shades) indicate high clustering (hot spots) of drug offenses in certain provinces.</p>
<p>Negative Gi* values (orange shades) suggest cold spots, i.e., areas with significantly low counts of offenses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>hcsa_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> yearly_listw_data[[year]]</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  nb <span class="ot">&lt;-</span> yearly_nb_data[[year]]</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  yearly_data <span class="ot">&lt;-</span> drug_offense_summary_all_cases <span class="sc">%&gt;%</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year, ADM1_EN <span class="sc">!=</span> <span class="st">"Phuket"</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> yearly_data<span class="sc">$</span>total_cases</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  hcsa <span class="ot">&lt;-</span> yearly_data <span class="sc">%&gt;%</span> </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="fu">local_gstar_perm</span>(var, nb, wt, <span class="at">nsim =</span> <span class="dv">99</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">"p_sim"</span> <span class="ot">=</span> <span class="fu">replace</span>(<span class="st">`</span><span class="at">p_sim</span><span class="st">`</span>, <span class="st">`</span><span class="at">p_sim</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="fl">0.1</span>, <span class="cn">NA</span>),</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>           <span class="st">"gi_star"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="st">`</span><span class="at">p_sim</span><span class="st">`</span>), <span class="cn">NA</span>, <span class="st">`</span><span class="at">gi_star</span><span class="st">`</span>))</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  hcsa_list[[year]] <span class="ot">&lt;-</span> hcsa</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="fu">names</span>(yearly_nb_data)) {</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  hcsa <span class="ot">&lt;-</span> hcsa_list[[year]]</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(hcsa) <span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"gi_star"</span>, <span class="at">palette=</span><span class="st">"PuOr"</span>, <span class="at">midpoint=</span><span class="dv">0</span>, <span class="at">title=</span><span class="st">"Gi*"</span>) <span class="sc">+</span> </span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(map)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-34-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-34-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-34-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-34-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The consistent hot spot in Bangkok (and surrounding regions) and shifting cold spots in northern Thailand indicate a stable pattern of high drug-related activity in urban areas. Some variability in low-activity zones, potentially influenced by evolving local conditions.</p>
</section>
<section id="cluster-persistance" class="level2">
<h2 class="anchored" data-anchor-id="cluster-persistance">7.2 Cluster Persistance</h2>
<p>By dentifying the number of times a province was classified as a hot or cold spot, we can try to visualize the results through a heatmap of persistence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>hcsa_list_no_geom <span class="ot">&lt;-</span> <span class="fu">lapply</span>(hcsa_list, <span class="cf">function</span>(x) <span class="fu">st_set_geometry</span>(x, <span class="cn">NULL</span>))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>persistence_df <span class="ot">&lt;-</span> hcsa_list_no_geom <span class="sc">%&gt;%</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">reduce</span>(full_join, <span class="at">by =</span> <span class="st">"ADM1_EN"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_next"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hot_count =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">"gi_star"</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cold_count =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">"gi_star"</span>)) <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">neutral_count =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">"gi_star"</span>))))</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(persistence_df[, <span class="fu">c</span>(<span class="st">"ADM1_EN"</span>, <span class="st">"hot_count"</span>, <span class="st">"cold_count"</span>, <span class="st">"neutral_count"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 4
   ADM1_EN       hot_count cold_count neutral_count
   &lt;chr&gt;             &lt;int&gt;      &lt;int&gt;         &lt;int&gt;
 1 Amnat Charoen         0          0             6
 2 Ang Thong             0          0             6
 3 Bangkok               0          0             6
 4 Bueng Kan             0          0             6
 5 Buri Ram              0          0             6
 6 Chachoengsao          4          0             2
 7 Chai Nat              0          5             1
 8 Chaiyaphum            0          0             6
 9 Chanthaburi           0          0             6
10 Chiang Mai            0          0             6
# ℹ 66 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>base_sf <span class="ot">&lt;-</span> hcsa_list[[<span class="dv">1</span>]] </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a spatial join with the persistence data</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>persistence_sf <span class="ot">&lt;-</span> base_sf <span class="sc">%&gt;%</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(persistence_df, <span class="at">by =</span> <span class="st">"ADM1_EN"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>hot_persistence_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(persistence_sf) <span class="sc">+</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hot_count"</span>, <span class="at">palette =</span> <span class="st">"Purples"</span>, <span class="at">title =</span> <span class="st">"Hot Spot Persistence"</span>,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"cont"</span>, <span class="at">border.alpha =</span> <span class="fl">0.5</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Hot Spot Persistence Across Years"</span>)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hot_persistence_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cold Spot Persistence Map</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>cold_persistence_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(persistence_sf) <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cold_count"</span>, <span class="at">palette =</span> <span class="st">"Oranges"</span>, <span class="at">title =</span> <span class="st">"Cold Spot Persistence"</span>,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"cont"</span>, <span class="at">border.alpha =</span> <span class="fl">0.5</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Cold Spot Persistence Across Years"</span>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cold_persistence_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take--Home_Ex02_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Bangkok and nearby provinces seem to be consistent hot spots over the years and other areas show some sporadic clustering, but with lower persistence.</p>
<p>Persistent cold spots are clustered aorund northern Thailand.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>