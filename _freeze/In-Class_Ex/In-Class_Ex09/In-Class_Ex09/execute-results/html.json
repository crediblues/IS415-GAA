{
  "hash": "ba8cc586bbb09a0d183f055ed8a6ea08",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In-Class Exercise 9\"\nauthor: \"Ooi Wen Xian\"\ndate: \"October 21, 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  freeze: true\n---\n\n\n# Loading R packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(spdep, tmap, sf, ClustGeo,                 ggpubr, cluster, factoextra, NbClust,                heatmaply, corrplot, psych, tidyverse, GGally)\n```\n:::\n\n\n# Data Set-up\n\n\n::: {.cell}\n\n```{.r .cell-code}\nict <- read_rds(\"data/rds/shan_ict.rds\")\nict\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            RADIO_PR    TV_PR LLPHONE_PR MPHONE_PR COMPUTER_PR\nMongmit    286.18517 554.1313  35.306182 260.69440   12.159391\nPindaya    417.46466 505.1300  19.835841 162.39170   12.881897\nYwangan    484.52147 260.5734  11.935906 120.28559    4.414650\nPinlaung   231.64994 541.7189  28.544542 249.49028   13.762547\nMabein     449.49027 708.6423  72.752549 392.60890   16.450417\nKalaw      280.76244 611.6204  42.064778 408.79514   29.631601\nPekon      318.61183 535.8494  39.832703 214.84764   18.970325\nLawksawk   387.10175 630.0035  31.513657 320.56863   21.766768\nNawnghkio  349.33590 547.9456  38.449603 323.02011   15.764647\nKyaukme    210.95485 601.1773  39.582672 372.49304   30.947094\nMuse       175.88008 842.5317 139.551634 712.92878   91.293779\nLaihka     153.35609 590.5575  65.529010 261.43345   27.758817\nMongnai    182.51928 515.9062   5.141388 267.51285   28.277635\nMawkmai     97.44231 234.5010   2.780095  36.41924    7.784265\nKutkai     238.71578 474.0161  62.897378 264.62088   21.070884\nMongton    193.51808 388.4453  25.129169 290.51198   21.841240\nMongyai    168.44238 364.2707  20.333133 135.12905    9.378752\nMongkaing  156.74749 116.0299   6.000490  50.75925    8.388440\nLashio     235.73893 680.7891  66.685148 463.83909   60.216842\nMongpan    228.74008 517.2477  21.582734 437.74211   46.485888\nMatman     244.12297 219.4093   8.438819  45.20796    6.027728\nTachileik  363.35354 759.4214  59.751756 735.43090   92.401937\nNarphan     75.27012 210.0886  42.187690 305.26891    3.277892\nMongkhet    79.37695 313.3956  29.034268 114.64174    6.853583\nHsipaw     198.12167 475.8613  32.316784 269.08669   14.588719\nMonghsat   107.67490 460.1169  34.508769 189.51537   22.817273\nMongmao    120.05744 512.6855  85.495452 424.98803   11.297271\nNansang    203.99724 585.6969  37.586810 314.63712   30.641998\nLaukkaing   53.26400 778.5117 134.354578 716.74513   35.556180\nPangsang    97.44765 490.3358  62.569694 440.83757   50.427456\nNamtu      240.01374 630.6159  35.220342 105.05970   19.929559\nMonghpyak  405.02839 503.3252  42.497972 381.83293   25.141930\nKonkyan     21.05456 287.0743 169.351886 316.73380   10.801904\nMongping   161.90476 330.8817  24.611033 190.75908   11.598303\nHopong     205.55645 455.8395  32.311550 209.96441   14.477515\nNyaungshwe 323.70878 554.4870  18.998921 351.19857   15.691701\nHsihseng   246.77306 505.5689  31.796405 145.09780    9.917305\nMongla      82.18126 673.1951  86.981567 555.10753   62.596006\nHseni      257.32235 628.8310  44.825537 431.87028   19.696069\nKunlong    121.92071 589.7806 181.485758 237.58661   20.785219\nHopang     127.60443 556.8737  81.746586 487.68817   24.523976\nNamhkan    134.98623 653.5462  91.796237 596.48877   30.162955\nKengtung   267.50939 637.7874  63.203895 487.32989   47.542234\nLangkho    227.46781 587.1483  74.391989 403.91035   32.308059\nMonghsu    235.95261 464.9495  11.629171 231.06184   12.389958\nTaunggyi   365.30919 755.2661  81.545688 586.66651   81.170403\nPangwaun    76.24025 366.7406  28.992770 518.14733    6.013315\nKyethi     268.62150 447.1408  22.357039  89.65285   12.807550\nLoilen     142.92267 552.6099  21.649390 253.00431   32.015411\nManton     194.32513 188.3379   8.069764  54.79630    3.644410\nMongyang    71.74622 569.3250 113.944066 469.01868   12.847119\nKunhing    161.48796 473.0853  73.085339 340.48140   26.039387\nMongyawng  278.08501 739.2953 121.978196 324.06383   15.326276\nTangyan    223.86318 453.2753  22.594047 105.23021   12.065335\nNamhsan    230.83668 390.5005  23.090976  97.77128    8.987943\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan_sf <- read_rds(\"data/rds/shan_sf.rds\")\nshan_sf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 55 features and 22 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 96.15107 ymin: 19.29932 xmax: 101.1699 ymax: 24.15907\nGeodetic CRS:  WGS 84\nFirst 10 features:\n             ST ST_PCODE     DT.x DT_PCODE.x      TS.x  TS_PCODE DT_PCODE.y\n1  Shan (North)   MMR015  Mongmit MMR015D008   Mongmit MMR015017 MMR015D003\n2  Shan (South)   MMR014 Taunggyi MMR014D001   Pindaya MMR014006 MMR014D001\n3  Shan (South)   MMR014 Taunggyi MMR014D001   Ywangan MMR014007 MMR014D001\n4  Shan (South)   MMR014 Taunggyi MMR014D001  Pinlaung MMR014009 MMR014D001\n5  Shan (North)   MMR015  Mongmit MMR015D008    Mabein MMR015018 MMR015D003\n6  Shan (South)   MMR014 Taunggyi MMR014D001     Kalaw MMR014005 MMR014D001\n7  Shan (South)   MMR014 Taunggyi MMR014D001     Pekon MMR014010 MMR014D001\n8  Shan (South)   MMR014 Taunggyi MMR014D001  Lawksawk MMR014008 MMR014D001\n9  Shan (North)   MMR015  Kyaukme MMR015D003 Nawnghkio MMR015013 MMR015D003\n10 Shan (North)   MMR015  Kyaukme MMR015D003   Kyaukme MMR015012 MMR015D003\n       DT.y      TS.y TT_HOUSEHOLDS RADIO    TV LLPHONE MPHONE COMPUTER\n1   Kyaukme   Mongmit         13652  3907  7565     482   3559      166\n2  Taunggyi   Pindaya         17544  7324  8862     348   2849      226\n3  Taunggyi   Ywangan         18348  8890  4781     219   2207       81\n4  Taunggyi  Pinlaung         25504  5908 13816     728   6363      351\n5   Kyaukme    Mabein          8632  3880  6117     628   3389      142\n6  Taunggyi     Kalaw         41341 11607 25285    1739  16900     1225\n7  Taunggyi     Pekon         20084  6399 10762     800   4315      381\n8  Taunggyi  Lawksawk         25957 10048 16353     818   8321      565\n9   Kyaukme Nawnghkio         32224 11257 17657    1239  10409      508\n10  Kyaukme   Kyaukme         28371  5985 17056    1123  10568      878\n   INTERNET RADIO_PR    TV_PR LLPHONE_PR MPHONE_PR COMPUTER_PR INTERNET_PR\n1       321 286.1852 554.1313   35.30618  260.6944    12.15939   23.513038\n2       136 417.4647 505.1300   19.83584  162.3917    12.88190    7.751938\n3       152 484.5215 260.5734   11.93591  120.2856     4.41465    8.284282\n4       737 231.6499 541.7189   28.54454  249.4903    13.76255   28.897428\n5       165 449.4903 708.6423   72.75255  392.6089    16.45042   19.114921\n6      1741 280.7624 611.6204   42.06478  408.7951    29.63160   42.113156\n7       316 318.6118 535.8494   39.83270  214.8476    18.97032   15.733918\n8       556 387.1017 630.0035   31.51366  320.5686    21.76677   21.420041\n9      1216 349.3359 547.9456   38.44960  323.0201    15.76465   37.735849\n10      936 210.9548 601.1773   39.58267  372.4930    30.94709   32.991435\n                         geometry\n1  MULTIPOLYGON (((96.96001 23...\n2  MULTIPOLYGON (((96.7731 21....\n3  MULTIPOLYGON (((96.78483 21...\n4  MULTIPOLYGON (((96.49518 20...\n5  MULTIPOLYGON (((96.66306 24...\n6  MULTIPOLYGON (((96.49518 20...\n7  MULTIPOLYGON (((97.14738 19...\n8  MULTIPOLYGON (((96.94981 22...\n9  MULTIPOLYGON (((96.75648 22...\n10 MULTIPOLYGON (((96.95498 22...\n```\n\n\n:::\n:::\n\n\n# Conventional Hierarchical Clustering\n\n## Hierarchical clustering \n\nhclust_ward is a hierarchical clustering object class\n\n\n::: {.cell}\n\n```{.r .cell-code}\nproxmat <- dist(ict, method = \"euclidian\")\nhclust_ward <- hclust(proxmat, method = 'ward.D')\ngroups <- as.factor(cutree(hclust_ward, k=6))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(groups)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Factor w/ 6 levels \"1\",\"2\",\"3\",\"4\",..: 1 1 2 1 3 3 1 3 3 3 ...\n - attr(*, \"names\")= chr [1:55] \"Mongmit\" \"Pindaya\" \"Ywangan\" \"Pinlaung\" ...\n```\n\n\n:::\n:::\n\n\n## Append to geospatial data\n\npacman::p_load(olsrr, corrplot, ggpubr, sf, spdep, GWmodel, tmap, tidyverse, gtsummary)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshan_sf_cluster <- cbind(shan_sf, as.matrix(groups)) %>% rename('CLUSTER' = as.matrix.groups.) %>%\n    select(-c(3:4, 7:9)) %>%\n    rename(TS = TS.x)\n```\n:::\n\n\n## The Dendrogram\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(hclust_ward, cex=0.6)\nrect.hclust(hclust_ward, k=6, border = 2:5)\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## Cluster map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqtm(shan_sf_cluster, 'CLUSTER')\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n# Spatially \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndist <- st_distance(shan_sf, shan_sf)\ndistmat <- as.dist(dist)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan.nb <-poly2nb(shan_sf)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(shan_sf),\n     border=grey(.5))\npts <- st_coordinates(st_centroid(shan_sf))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: st_centroid assumes attributes are constant over geometries\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(shan.nb, pts, col='blue', add=TRUE)\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlcosts <- nbcosts(shan.nb, ict)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan.w <- nb2listw(shan.nb, lcosts, style = \"B\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshan.mst <- mstree(shan.w)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(shan_sf), border=gray(.5))\nplot.mst(shan.mst, pts, col='blue',cex.lab = 0.7, cex.circles = 0.005, add=TRUE)\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n# Computing spatially constrained clusters using SKATER\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskater.cluster <- skater(edges = shan.mst[,1:2],\n                         data = ict,\n                         method = 'euclidean',\n                         ncuts = 5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(shan_sf), border = gray(0.5))\nplot(skater.cluster, pts, \n     cex.lab = 0.7, \n     groups.colors = c(\"red\", \"green\", \"blue\", \"brown\", \"pink\"), \n     cex.circles = 0.01,  # Increase circle size if needed\n     add = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in segments(coords[id1, 1], coords[id1, 2], coords[id2, 1], coords[id2,\n: \"add\" is not a graphical parameter\nWarning in segments(coords[id1, 1], coords[id1, 2], coords[id2, 1], coords[id2,\n: \"add\" is not a graphical parameter\nWarning in segments(coords[id1, 1], coords[id1, 2], coords[id2, 1], coords[id2,\n: \"add\" is not a graphical parameter\nWarning in segments(coords[id1, 1], coords[id1, 2], coords[id2, 1], coords[id2,\n: \"add\" is not a graphical parameter\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngroups_mat <- as.matrix(skater.cluster$groups)\nshan_sf_spatialcluster <- cbind(shan_sf_cluster, as.factor(groups_mat)) %>% rename(`skater_CLUSTER` = `as.factor.groups_mat.`)\nqtm(shan_sf_spatialcluster, \"skater_CLUSTER\")\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncr <- choicealpha(proxmat, distmat, range.alpha = seq(0, 1, 0.1), K=6, graph = TRUE)\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-19-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclustG <- hclustgeo(proxmat, distmat, alpha = 0.2)\n\ngroups <- as.factor(cutree(clustG, k=6))\nshan_sf_clustGEO <- cbind(shan_sf, as.matrix(groups)) %>%\n  rename(`CLUSTER` = `as.matrix.groups.`)\n\nqtm(shan_sf_clustGEO, \"CLUSTER\")\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggparcoord(data = shan_sf_clustGEO, \n           columns = c(17:21), \n           scale = \"globalminmax\",\n           alphaLines = 0.2,\n           boxplot = TRUE, \n           title = \"Multiple Parallel Coordinates Plots of ICT Variables by Cluster\") +\n  facet_grid(~ CLUSTER) + \n  theme(axis.text.x = element_text(angle = 30))\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex09_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "In-Class_Ex09_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}